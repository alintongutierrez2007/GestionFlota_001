<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />

    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="jquery.mobile-1.4.5.min.css" />
    <script src="jquery-2.1.1.js"></script>
    <script src="jquery.mobile-1.4.5.min.js"></script>

    <link rel="stylesheet" href="MyStyle.css">

	<link rel="stylesheet" href="menu/styles.css">
    <script src="menu/script.js"></script>

	<link rel="stylesheet" href="jquery-confirm.min.css">
    <script src="jquery-confirm.min.js"></script>
	
    <script src="jquery.knob.js"></script>
	<script src="jQuery-File-Upload-10.2.0/js/jquery.ui.widget.js"></script>
    <script src="jQuery-File-Upload-10.2.0/js/jquery.iframe-transport.js"></script>
    <script src="jQuery-File-Upload-10.2.0/js/jquery.fileupload.js"></script>
	
	<script src="sign/signature_pad.min.js"></script>
	
	
	<script src="aes.js"></script>
	
	  <title>App Registros</title>
</head>
<body id="body">
 
<noscript>
    <style type="text/css">.paginas {display:none;}</style>
    <div class="noscriptmsg">tu no posees Javascript habilitado.</div>
</noscript>





<!--login de app-PAGINA INICIAL DE APLICACION LOGIN -->

<div data-role="page" class="paginas" id="inicio">
	<div data-role="header">
		<h1>Login</h1>
	</div>
	<div data-role="content">
	
	<div id="main_login">
    <img src="logo_disatel.png"/>

  <br/><br/>
		<form id="formulario" data-ajax="false"  style="padding-left:5px;">
      			<label> Usuario </label>
				<div style="width:90%;">
      			<input type="text"  id="nombredeusuario" name="usr" required/>
				</div>
      			<label> Contraseña </label>   
				 <div style="width:80%;display: inline-block">
				   <input type="password" id="clave" name="clave" required/>
				 </div>
     			 <span id="password_ver" data-theme="a" style="width: 10px !important;display: inline-block;padding-left:5px;padding-right:25px;"  class="ui-btn ui-icon-eye ui-btn-icon-left ui-btn-inline ui-corner-all"></span>
      			<input type="submit" value="Login" id="btnLogin" style="background-color:#5ac8fa;"/>
        </form>
    <br/>
    <a href="#" id='btnOlvide' style="padding-left:5px;">Olvide la contraseña</a>
	</div>
	</div>

</div>

<!--fin login de app-PAGINA INICIAL DE APLICACION LOGIN -->




<!--inicio de app-  PAGINA HOME DE APLICACION  -->

<div data-role="page" class="paginas" id="home">
<div data-role="header">
<div id='cssmenu'>

<ul>
<li><a href='#' id='link_pxabordaje'>Checklist Inicial</a>
          <ul data-theme="b">
              <li><a href='#' id='link_agregarChecklist'>agregar</a></li>
              <li><a href='#' id='link_historicoChecklist'>Historial</a></li>
          </ul>
</li>
<li><a href='#'>Informe de Accidente</a>
          <ul data-theme="b">
              <li><a href='#' id='link_agregarAccidente'>agregar</a></li>
              <li><a href='#' id='link_historicoAccidente'>Detalle</a></li>
          </ul>
</li>
<li><a href='#' id='link_pxabordaje'> Recepcion y Entrega Vehiculos</a>
           <ul data-theme="b">
              <li><a href='#' id='link_nuevaEntrega'>agregar</a></li>
              <li><a href='#' id='link_historicoEntrega'>Detalle</a></li>
          </ul>
</li>
<li><a href='#' id='link_appcuenta'>Mi Cuenta</a></li>
<li><a href='#' id='link_salirapp'>salir</a></li>
</ul>

</div>
 
</div>

<div data-role="content">


<br/>
<img style="width:50%;height:50%;" id="imagen_camion"  src="Fondo01.png"/>


</div>

<div data-role="footer" style="position:absolute;bottom:0;width: 100%;height:35px;">
 <h1>Powered By Disatel NI</h1>
</div>

</div>

<!--fin de app-  PAGINA HOME DE APLICACION  -->

 
<!--inicio de app-PAGINA checklist-->

<div data-role="page"  class="paginas" id="pg_insertChecklist" data-cache="false">

<div data-role="header" style="height:55px;">
<button id='atras_pg_nuevoCheck'>Atras</button>
<h1> Nuevo Checklist</h1>
</div>

<div data-role="content" id='contendorTabla'>



<div data-role="fieldcontain" id="contendorMiSelect">
   <label class="select_unidades">Unidad
   <select id="select_unidad"></select>
   </label>
</div>

<div data-role="fieldcontain" id="contendorMiSelect" >
   <label class="select_unidades" style="display:inline;">Kilometraje<a style="color:red;">*</a>
   <input type="number" id="km_unidad"  min="1" required/>
   </label>
</div>




<div class="table-wrapper-scroll-y my-custom-scrollbar">

<table data-role="table"   data-mode="reflow"  class="ui-responsive" id="my-table-options">
 <thead>
       <tr>
	     <th>#</th>
	     <th>Item</th>
         <th></th>
       </tr>
 </thead>
	  <tbody id='tbody_items'>
      </tbody>
</table>
</div>
<br/>

<div>
<textarea id="texoObservacion" class="texoObservacion" rows="4"  cols="50" style="width:80%; margin: 0 auto;" placeholder="observacion"></textarea> 
<br/>
<button  id="BtnGuardarCheck" class="ui-btn" class="center-button" style="background-color:#5ac8fa;width:50%; margin: 0 auto;">Guardar</button> 
</div>

</div>

<div data-role="footer" data-position="fixed">
         <label>Campos obligatorios <a style="color:red;">*</a></label>
   </div>
</div>

<!-- fin de pagin checklist-->

 
 
<!--pagina historial Checklist-->

<div data-role="page" class="paginas" id="historialCheck">

<div data-role="header" style="height:55px;">
<button id='atras_hi_Check'>Atras</button>
     <h1>Historial Checklist</h1>
</div>


<div data-role="content">


<div data-role="popup" id="popupEditCheck" data-theme="a" class="ui-corner-all" style="width:90%;">
    <div  id="div_Edit" style="padding:10px 20px;">
          <h3>Actualizar Checklist</h3>
          <label id="id_update_check" style="display:none;"></label>

          <div data-role="fieldcontain" id="selector_edicion_unidad">
            <label class="select">Unidad
             <select id="unidad_edit"></select>
             </label>
           </div>
		   <br/>
		<div class="table-wrapper-scroll-y my-custom-scrollbar">   
      <table data-role="table"   data-mode="reflow" class="ui-responsive ui-table ui-table-reflow" id="my-table-update">
      <thead>
          <tr>
	       <th>#</th>
	       <th>Item</th>
           <th></th>
         </tr>
      </thead>
	  <tbody id='tbody_items_updt'>
      </tbody>
      </table>
	  </div>
    <br/>
     <textarea id="updt_Observacion" rows="4" cols="50" style="width:80%; margin: 0 auto;" placeholder="observacion"></textarea> 
     <br/>

     <button id="btn_update_check" data-theme="a" data-icon="gear" style="background-color:#5ac8fa;">Actualizar</button>
     <button id="btn_cancel_check" data-theme="a" data-icon="delete">Cancelar</button>
			   
   </div>


</div>

<div role="main" class="ui-content">
<table data-role="table" data-mode="reflow" class="ui-responsive" id="gridview-checklist">
  <thead>
    <tr>
         <th>No</th>
         <th data-priority="1">Unidad</th>
         <th data-priority="2">Registrado</th>
		 <th data-priority="3">Edicion</th>
		 <th data-priority="4">Cancelar</th>
    </tr>
  </thead>
  <tbody id="tb_historico_check">
  </tbody>
</table>
</div>

</div>


</div>

<!-- fin de pagin Historialchecklist-->

 

<!--pagina de accidente -->
<div data-role="page"  class="paginas" id="pg_insertAccidente" data-cache="false">

<div data-role="header" style="height:55px;" >
<button id='atras_pg_nuevoAccidente'>Atras</button>
<h1> Nuevo Informe Accidente</h1>
</div>


<div data-role="popup" id="viewPicturesAcc" data-dom-cache="true" data-position-to="window" data-transition="turn" style="width:350px;height:320px;">

<a href="#" data-rel="back" class="ui-btn ui-btn-right ui-btn-b ui-btn-icon-notext ui-icon-delete ui-corner-all">Close</a>

<div>
<img style="width:300px;height:295px;background-color:#d5f4e6;margin-left:10px;margin-top:10px;" 
id="imagen_popupAcc" src="images/ajax-loader.gif" />
<button id="giro_imagenAcc" style="display:inline-block" data-theme="b" class="ui-btn ui-icon-forward ui-btn-icon-notext ui-corner-all"></button>
</div>

</div> 





<div data-role="content" id='contendorAccidente'>


<div data-role="collapsible" name="Datos_generales" id="Datos_generales_acc">
       
<h3>Datos Generales</h3>

<fieldset data-role="controlgroup">

<div data-role="fieldcontain">
      <label class="select">Pais<a style="color:red;">*</a>
        <select id="pais_acc"></select>
      </label> 
</div>

<div data-role="fieldcontain">
   <label class="select">Departamentos<a style="color:red;">*</a>
       <select id="dept_acc"></select> 
	</label> 
</div>
  
<div data-role="fieldcontain">
 <label class="select">Unidad<a style="color:red;">*</a>
 <select id="select_unidad_Acc"></select>
 </label>
</div>
     
</fieldset>           
          
</div>

<div data-role="collapsible" id="Datos_conductor">
  <h3>Datos Conductor</h3>
<div>
    
              <fieldset data-role="controlgroup">
			  
			  <div data-role="fieldcontain">
                   <label>Conductor:<a style="color:red;">*</a></label>
                   <input type="text" id="conductor_acc" minlength="5" maxlength="100" required/>
                 </div>
          
                 <div data-role="fieldcontain">
                   <label>Licencia No.<a style="color:red;">*</a></label>
                   <input type="text" id="licencia_acc" minlength="5" maxlength="50" required/>
                 </div>
				 
                 <div data-role="fieldcontain">
                   <label>Tipo licencia:<a style="color:red;">*</a></label>
                   <input type="text" id="tipo_lic_acc"  maxlength="50" required/>
                 </div>
				 
				 <div data-role="fieldcontain">
                   <label>Fecha Expiracion:<a style="color:red;">*</a></label>
                   <input type="date" id="expiracion_lic" required/>
                 </div>

                 <div data-role="fieldcontain">
                   <label>Residencia:<a style="color:red;">*</a></label>
                   <textarea type="text" id="direc_cond_acc" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="500" required></textarea>
                 </div>

                <div data-role="fieldcontain">
                   <label>Telefono:<a style="color:red;">*</a></label>
                   <input type="tel"  id="telf_cond_acc" maxlength="50" required/>
                 </div>

                 <div data-role="fieldcontain">
                   <label>Edad:<a style="color:red;">*</a></label>
                   <input type="number" id="edad_cond_acc"  min="17" max="80" required/>
                 </div>

               </fieldset>

 </div>
 </div>

<div data-role="collapsible" name="vehiculo">
       
<h3>Datos Vehiculo</h3>

<div>

               <div data-role="fieldcontain">
                 <label class="label">Marca:
				  <input type="text" id="Brand" value="" disabled/>
				 </label>
                </div>


                <div data-role="fieldcontain">
                 <label class="label">Modelo:
				  <input type="text"  id="model" value="" disabled/>
				 </label>
                </div>


                 <div data-role="fieldcontain">
                 <label class="label">Placa:
				  <input type="text"  id="plate" value="" disabled/>
				 </label>
                </div>
				
				
				<div data-role="fieldcontain">
                 <label class="label">año:
				  <input type="text"  id="year" value="" disabled/>
				 </label>
                </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Tipo:
				  <input type="text"  id="tipo_veh_acc" value="" disabled/>
				 </label>
                </div>

</div>

</div>

<div data-role="collapsible" id="fecha_accidente">
       
<h3>Fecha-hora Accidente</h3>

<div>

               <div data-role="fieldcontain">
                 <label class="label">Fecha del accidente:<a style="color:red;">*</a>
				  <input type="date"  id="fecha_acc" value="" required/>
				 </label>
                </div>


                <div data-role="fieldcontain">
                 <label class="label">Hora:<a style="color:red;">*</a>
				  <input type="time"  id="hora_acc" value="" required/>
				 </label>
                </div>


                 <div data-role="fieldcontain">
                 <label class="label">No.Boleta policia:<a style="color:red;">*</a>
				  <input type="text"  id="boleta_poli_acc" minlength="5" maxlength="150" value="" required/>
				 </label>
                </div>
				
				<div data-role="fieldcontain">
                 <label class="label">No.Boleta aseguradora:<a style="color:red;">*</a>
				  <input type="text"  id="boleta_aseg_acc" minlength="5" maxlength="150"  value="" required/>
				 </label>
                </div>
				
</div>

</div>

<div data-role="collapsible" id="lugar_accidente">
       
<h3>Lugar Accidente</h3>

<div>

               <div data-role="fieldcontain">
                 <label class="label">Departamento-Provincia:<a style="color:red;">*</a>
				  <input type="text"  id="provincia_acc" value="" minlength="5" maxlength="100" required/>
				 </label>
                </div>


                <div data-role="fieldcontain">
                 <label class="label">Barrio-canton:<a style="color:red;">*</a>
				  <input type="text"  id="canton_acc" minlength="5" maxlength="100" value="" required/>
				 </label>
                </div>


                 <div data-role="fieldcontain">
                 <label class="label">Calle:<a style="color:red;">*</a>
				  <input type="text"  id="calle_acc" value="" minlength="5" maxlength="100" required/>
				 </label>
                </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Avenida:<a style="color:red;">*</a>
				  <input type="text"  id="avenida_acc" value="" minlength="5" maxlength="100" required/>
				 </label>
                </div>
				
				
				<div data-role="fieldcontain">
                 <label class="label">Lugar preciso:<a style="color:red;">*</a>
				  <textarea type="text" id="lugar_acc"  rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="450" required></textarea>
				 </label>
                </div>
				
</div>

</div>

<div data-role="collapsible" id="Tipo_accidente">
       
<h3>Tipo Accidente</h3>

<div>

               <div data-role="fieldcontain">
			   
			     <select id="tipo_Acc_class">
                  <option value="1">Evitable</option>
                   <option value="2">No Evitable</option>
				    <option value="3">Robo</option>
                 </select>
			   
                </div>
				
				
                 <br/>
                 <br/>

				
				<div data-role="fieldcontain">
				
				  <select id="zona_Acc_class">
                    <option value="1">Frente</option>
                     <option value="2">Atras</option>
  				    <option value="3">Costado</option>
					<option value="4">Otro</option>
                   </select>
				
				 
                </div>
				
</div>

</div>

<div data-role="collapsible" id="Estado_Carretera">
       
<h3>Estado de la Carretera</h3>

<div>

               <div data-role="fieldcontain">
			   
			     <select id="tipo_Carr_class">
                    <option value="1">Asfalto</option>
                     <option value="2">Lastre-Adoquines</option>
  				    <option value="3">Cemento</option>
					<option value="4">Otro</option>
                   </select>
			   
                </div>
				
                 <br/>
				 
				  <div data-role="fieldcontain"> 
                   <br/>
				 <label class="label">Estado del clima:<a style="color:red;">*</a>
			       <textarea type="text" id="clima_acc"  class="ContendorMedio" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="450" required></textarea>
				 </label>
				  </div>
				  
				  
				  <div data-role="fieldcontain"> 
                   <br/>
				 <label class="label">breve explicacion de daño a vehiculo empresa:<a style="color:red;">*</a>
				   <textarea type="text" id="explicacion_acc" class="ContendorMedio"  rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="550" required></textarea>
				 </label>
				  </div>
				  
</div>

</div>

<div data-role="collapsible" name="otros_vehiculos">
       
<h3>Otros Vehiculos</h3>

<div>

               <div data-role="fieldcontain">
			    <label class="label">vehiculo 1:</label>
				
                 <label class="label">Marca:
				  <input type="text"  maxlength="50"  id="marca_otro1" />
				 </label>
				 
				 <label class="label">Tipo:
				  <input type="text"  maxlength="50"  id="tipo_otro1" />
				 </label>
				
				 
				 <label class="label">Placa:
				  <input type="text" maxlength="50" id="placa_otro1" />
				 </label>
				 
				
				 <label class="label">Daño:
				  <input type="text" maxlength="450" id="danio_otro1" />
				 </label>
				 
				
				 <label class="label">Propietario:
				  <input type="text" maxlength="100" id="propietario_otro1"/>
				 </label>
				
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_otro1" />
				 </label>
				
				 
				 <label class="label">Telefono:
				  <input type="text" maxlength="50" id="telefono_otro1" />
				 </label>
				 
                </div>
				
				
                 <br/>
				 
				 <div data-role="fieldcontain">
			    <label class="label">vehiculo 2:
				</label>
				
                 <label class="label">Marca:
				  <input type="text" maxlength="50" id="marca_otro2" />
				 </label>
				
				 <label class="label">Tipo:
				  <input type="text" maxlength="50" id="tipo_otro2" />
				 </label>
				
				 
				 <label class="label">Placa:
				  <input type="text" maxlength="50" id="placa_otro2" />
				 </label>
				 
				
				 <label class="label">Daño:
				  <input type="text" maxlength="50" id="danio_otro2" />
				 </label>
				 
				 
				 
				 <label class="label">Propietario:
				  <input type="text" maxlength="50" id="propietario_otro2" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="250" id="direccion_otro2" />
				 </label>
				 
				 
				 <label class="label">Telefono:
				  <input type="text" maxlength="50" id="telefono_otro2" />
				 </label>
				 
                </div>
				
				
				<br/>
				
				<div data-role="fieldcontain">
			    <label class="label">vehiculo 3:
				</label>
				
				<br/>
                 <label class="label">Marca:
				  <input type="text" maxlength="50" id="marca_otro3" />
				 </label>
				
				
				 <label class="label">Tipo:
				  <input type="text" maxlength="50" id="tipo_otro3" />
				 </label>
				
				 
				 <label class="label">Placa:
				  <input type="text" maxlength="50" id="placa_otro3" />
				 </label>
				 
				
				 <label class="label">Daño:
				  <input type="text" maxlength="50" id="danio_otro3" />
				 </label>
				 
				  
				  
				 <label class="label">Propietario:
				  <input type="text"  maxlength="50" id="propietario_otro3" />
				 </label>
				
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="250" id="direccion_otro3" />
				 </label>
				
				
				 
				 <label class="label">Telefono:
				  <input type="text" maxlength="50" id="telefono_otro3" />
				 </label>
				 
                </div>
				
				
				
				<br/>
				
				<div data-role="fieldcontain">
			    <label class="label">vehiculo 4:</label>
				
                 <label class="label">Marca:
				  <input type="text" maxlength="50" id="marca_otro4" />
				 </label>
				
				 <label class="label">Tipo:
				  <input type="text" maxlength="50" id="tipo_otro4" />
				 </label>
				
				 
				 <label class="label">Placa:
				  <input type="text" maxlength="50" id="placa_otro4" />
				 </label>
				 
				
				 <label class="label">Daño:
				  <input type="text" maxlength="50" id="danio_otro4" />
				 </label>
				 
				 
				
				 <label class="label">Propietario:
				  <input type="text" maxlength="50" id="propietario_otro4" />
				 </label>
				
				 
				 <label class="label">Direccion:
				  <input type="text" maxlength="250" id="direccion_otro4" />
				 </label>
				
				 
				 <label class="label">Telefono:
				  <input type="text" maxlength="50" id="telefono_otro4" />
				 </label>
				 
                </div>
				 
				  
 </div>

</div>

<div data-role="collapsible" name="Datos_Pasajeros">
<h3>Datos Pasajeros</h3>
<div>
               <div data-role="fieldcontain">
			   
			    <label class="label">vehiculo Compañia</label>
				
                 <label class="label">Nombre:
				  <input type="text" maxlength="100" id="nombre_pas" />
				 </label>
				
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_pas" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_pas" />
				 </label>
				
				 <label class="label">Telefono:
				  <input type="text" maxlength="50" id="telefono_pass" />
				 </label>
			
				 <label class="label">vehiculo:
				  <input type="text" maxlength="50" id="vehiculo_pass" />
				 </label>
				 
                </div>
				
                 <br/>
				 
				 <div data-role="fieldcontain">
				 
				 <label class="label">vehiculo 1</label>
				
                 <label class="label">Nombre:
				  <input type="text" maxlength="100" id="nombre_pas1" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_pas1" />
				 </label>
				 
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_pas1" />
				 </label>
				
				 <label class="label">Telefono:
				  <input type="text"  id="telefono_pas1" maxlength="50" />
				 </label>
				 
				 <label class="label">vehiculo:
				  <input type="text" maxlength="50" id="vehiculo_pass1" />
				 </label>
				 
                </div>
				
                 <br/>
				 
				 <div data-role="fieldcontain">
				 
				 <label class="label">vehiculo 2</label>
				
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_pas2" />
				 </label>
				 
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50"  id="identificacion_pas2" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_pas2" />
				 </label>
				 
				 <label class="label">Telefono:
				  <input type="text" maxlength="50" id="telefono_pas2" maxlength="50" />
				 </label>
				 
				 <label class="label">vehiculo:
				  <input type="text" maxlength="50" id="vehiculo_pass2" />
				 </label>
				 
                </div>
                  
        </div>

</div>

<div data-role="collapsible" name="Testigos">      
<h3>Testigos</h3>
<div>

               <div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text"  maxlength="150" id="nombre_testigo" />
				 </label>
				 
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_testigo" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text"  maxlength="450" id="direccion_testigo" />
				 </label>
				 
				 <label class="label">Telefono:
				  <input type="text" maxlength="50" id="telefono_testigo" />
				 </label>
				 
                </div>
               
			   <br/>
				 
				 <div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="150"  id="nombre_testigo1" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50"  id="identificacion_testigo1" />
				 </label>
				 
				 <label class="label">Direccion:
				  <input type="text" maxlength="450"  id="direccion_testigo1" />
				 </label>
				
				 <label class="label">Telefono:
				  <input type="text" maxlength="50"   id="telefono_testigo1" />
				 </label>
				 
                </div>
                 		  
        </div>

</div>

<div data-role="collapsible" name="Lesionados">
       
<h3>Lesionados</h3>

        <div> 
		     <div data-role="fieldcontain">
              <label class="label">Conductor Veh Cia </label>
			  </div>
			  
               <div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100" id="nombre_lesionados" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450"  id="direccion_lesionados" />
				 </label>
				 
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion" />
				 </label>
				
                </div>
				
				<br/>
				
			  <div data-role="fieldcontain">
              <label class="label">Pasajero Veh Cia </label>
			  </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados1" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados1" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados1" />
				 </label>
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion1" />
				 </label>
				
                </div>
				
				<br/>
				
				 <div data-role="fieldcontain">
                  <label class="label">Conductor Veh 1 </label>
			      </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados2" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados2" />
				 </label>
				 
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados2" />
				 </label>
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion2" />
				 </label>
				
                </div>
				
				<br/>
				 <div data-role="fieldcontain">
                 <label class="label">Pasajero Veh 1 </label>
			     </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados3" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados3" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados3" />
				 </label>
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion3" />
				 </label>
				 
                </div>
				
				
				<br/>
				 <div data-role="fieldcontain">
                  <label class="label">Conductor Veh 2 </label>
			     </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados4" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados4" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados4" />
				 </label>
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion4" />
				 </label>
                </div>
				
				<br/>
				 <div data-role="fieldcontain">
                  <label class="label">Pasajero Veh 2 </label>
			      </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados5" />
				 </label>
				
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados5" />
				 </label>
				
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados5" />
				 </label>
				
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion5" />
				 </label>
				 			 
                </div>
				
				<br/>
				
				<div data-role="fieldcontain">
				<label class="label">Peaton: </label><br>
                 <label class="label">Nombre:
				  <input type="text" maxlength="100" id="nombre_peaton" />
				 </label>
				 
				 <label class="label">Identificacion:
				  <input type="text"  maxlength="50" id="identificacion_peaton" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text"  maxlength="450" id="direccion_peaton" />
				 </label>
				
				 <label class="label">Tipo Lesion:
				  <input type="text"  maxlength="450" id="tipo_lesion_peaton" />
				 </label>
				 
                </div>
                  
    </div>

</div>

<div data-role="collapsible" id="Relato">  
<h3>Relato</h3>
<div>
    <div data-role="fieldcontain">
       <label class="label">Relato:<a style="color:red;">*</a>
		<textarea type="text" id="relato_acc"  class="ContendorMedio" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="800" required></textarea>
		</label>
	</div>         
</div>
</div>

<div data-role="collapsible" id="Fotos">     
<h3>fotos</h3>

<div>
        <div data-role="fieldcontain">
       
				 <form method="post" action="" enctype="multipart/form-data" id="myform">
                   <input type="file" id="file" name="file" />
                   <input type="button" class="button" value="Upload" id="but_upload"/>
                 </form>
 
                <!-- Image element container -->
                <div class="container"></div> 
        </div>
                  
  </div>

</div>

<div data-role="collapsible" id="FirmaConductor">     
  <h3>Firma Conductor</h3>
 <div>
   <div data-role="fieldcontain">
     <label>Firma Conductor:<a style="color:red;">*</a></label>
    <br/><br/>
     <div id="signature" style='width:180px; height:180px; border: 1px solid black;'>
       <canvas id="signature-pad" class="signature-pad" width="180px" height="180px"></canvas>
     </div>
      <br/>
    <a href='#' id='clear'>Clear</a>
     <label>Aceptar Firma  <input type="checkbox" data-cache="false" id="saved_signed"/></label>
    <br/>
  </div>
                           
 </div>
         
</div>	


<br/><br/>

<div data-role="fieldcontain">
<button  id="BtnGuardarAcc" class="ui-btn" class="center-button" style="background-color:#5ac8fa;width:50%; margin: 0 auto;">Guardar Accidente</button> 
</div>


</div>

<div data-role="footer" data-position="fixed">
         <label>Campos obligatorios <a style="color:red;">*</a></label>
   </div>
</div>

<!-- fin de pagina de accidente -->


 
 
 <!--pagina de  historial accidente -->

<div data-role="page" class="paginas" id="pg_historialAccidente">

<div data-role="header" style="height: 55px;" >
<button id='atras_hi_accidente'>Atras</button>
<h1>Historial Accidentes</h1>
</div>


<div data-role="content">



<div data-role="popup" id="popupAccidente" data-theme="a" style="width:90%;" class="ui-corner-all">
   

<div style="padding:10px 20px;">
     <h3>Actualizar Accidente</h3>
     <label id="id_update_accidente" style="display:none;"></label>
		  
		  
         
		 
<div data-role="collapsible" name="Datos_generales">


<h3>Datos Generales</h3>

<fieldset data-role="controlgroup">

            <div data-role="fieldcontain">
                <label class="select">Pais
                 <select id="pais_acc_edit"></select>
                </label> 
              </div>

            <div data-role="fieldcontain">
               <label class="select">Departamentos
                <select id="dept_acc_edit"></select> 
	          </label> 
            </div>
			
			<div data-role="fieldcontain">
              <label class="select">Unidad
               <select id="select_unidad_Acc_edit"></select>
              </label>
            </div>
</fieldset>  
</div>
 
 
<div data-role="collapsible" id="Datos_conductor_edit">
       
<h3>Datos Conductor</h3>

<div>
             
<fieldset data-role="controlgroup">
 
  <div data-role="fieldcontain">
  <label>Conductor:</label>
  <input type="text" id="conductor_acc_edit" minlength="5" maxlength="100" required/>
  </div>
           

   <div data-role="fieldcontain">
   <label>Licencia No.</label>
   <input type="text" id="licencia_acc_edit" minlength="5" maxlength="50" required/>
   </div>
				 
   <div data-role="fieldcontain">
   <label>Tipo licencia:</label>
   <input type="text" id="tipo_lic_acc_edit"  maxlength="50" required/>
   </div>
				 
    <div data-role="fieldcontain">
    <label>Fecha Expiracion:</label>
    <input type="date" id="expiracion_lic_edit" required/>
    </div>
	
	
    <div data-role="fieldcontain">
    <label>Residencia:</label>
    <textarea type="text" id="direc_cond_acc_edit" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="500" required></textarea>
    </div>


    <div data-role="fieldcontain">
    <label>Telefono</label>
    <input type="tel"  id="telf_cond_acc_edit" maxlength="50" required/>
    </div>

    <div data-role="fieldcontain">
    <label>Edad</label>
    <input type="number" id="edad_cond_acc_edit" min="17" max="80" required/>
    </div>

 
</fieldset>

</div>
</div>


<div data-role="collapsible" id="fecha_accidente_edit">
       
<h3>Fecha-hora Accidente</h3>

<div>

   <div data-role="fieldcontain">
    <label class="label">Fecha del accidente:
     <input type="date"  id="fecha_acc_edit" value="" required/>
    </label>
   </div>

   <div data-role="fieldcontain">
    <label class="label">Hora:
	<input type="time"  id="hora_acc_edit" value="" required/>
	</label>
   </div>


   <div data-role="fieldcontain">
    <label class="label">No.Boleta policia:
	 <input type="text"  id="boleta_poli_acc_edit" minlength="5" maxlength="150" value="" required/>
	</label>
    </div>
				
	<div data-role="fieldcontain">
     <label class="label">No.Boleta aseguradora:
	  <input type="text"  id="boleta_aseg_acc_edit" minlength="5" maxlength="150"  value="" required/>
	 </label>
     </div>
				 
</div>
</div>


<div data-role="collapsible" id="lugar_accidente_edit">
       
<h3>Lugar Accidente</h3>

<div>

 <div data-role="fieldcontain">
  <label class="label">Departamento-provincia:
  <input type="text"  id="provincia_acc_edit" value="" minlength="5" maxlength="100" required/>
  </label>
  </div>


   <div data-role="fieldcontain">
   <label class="label">Barrio-canton:
   <input type="text"  id="canton_acc_edit" minlength="5" maxlength="100" value="" required/>
	</label>
    </div>


   <div data-role="fieldcontain">
   <label class="label">calle:
   <input type="text"  id="calle_acc_edit" value="" minlength="5" maxlength="100" required/>
   </label>
   </div>
				
	<div data-role="fieldcontain">
    <label class="label">Avenida:
	<input type="text"  id="avenida_acc_edit" value="" minlength="5" maxlength="100" required/>
	</label>
    </div>
				
				
	<div data-role="fieldcontain">
     <label class="label">Lugar preciso:
	 <textarea type="text" id="lugar_acc_edit"  class="ContendorMedio" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="450" required></textarea>
	  </label>
     </div>
				
</div>
</div>


<div data-role="collapsible" id="Tipo_accidente_edit">
       
<h3>Tipo Accidente</h3>

<div>

     <div data-role="fieldcontain">
	  <label class="label">Clasificacion Accidente </label>
	  <select id="casificacion_acc_edit">
	   <option value="1">Evitable</option>
       <option value="2">No Evitable</option>
       <option value="3">Robo</option>
	  </select> 
      </div>
	 
      <br/><br/>

	<div data-role="fieldcontain">
	  <label class="label">Tipo Accidente </label>
	  <select id="tipo_acc_edit">
	   <option value="1">Frente</option>
       <option value="2">Atras</option>
       <option value="3">Costado</option>
	   <option value="4">Otro</option>
	  </select> 
      </div>	
			
</div>
</div>


<div data-role="collapsible" id="Estado_Carretera_edit">
       
<h3>Estado de la Carretera</h3>

<div>

      <div data-role="fieldcontain">
	   <label class="label">Tipo Carretera</label>
	   <select id="tipo_carrt_acc_edit">
	   <option value="1">Asfalto</option>
       <option value="2">Lastre</option>
       <option value="3">Cemento</option>
	   <option value="4">Otro</option>
	   </select> 
      </div>
	  
       <br/>


          <div data-role="fieldcontain">   
			<label class="label">Estado del clima:
			  <textarea type="text" id="clima_acc_edit" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="450" required></textarea>
			</label>
		  </div>	
		  
		<br/>  
		
		  <div data-role="fieldcontain"> 
           <label class="label">breve explicacion de daño a vehiculo empresa:
			<textarea type="text" id="explicacion_acc_edit" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="550" required></textarea>
		   </label>
		</div>
				  
</div>
</div>


<div data-role="collapsible" name="otros_vehiculos">
       
<h3>Otros Vehiculos</h3>

<div>


     <div data-role="fieldcontain">
		<label class="label">vehiculo 1:</label>
		
		<label class="label">Marca:
		 <input type="text"  maxlength="50"  id="marca_otro1_edit" />
		</label>
				 
		<label class="label">Tipo:
		  <input type="text"  maxlength="50"  id="tipo_otro1_edit" />
		 </label>
				
				 
		<label class="label">Placa:
		  <input type="text" maxlength="50" id="placa_otro1_edit" />
		</label>
				 
				
		<label class="label">Daño:
		   <input type="text" maxlength="450" id="danio_otro1_edit" />
		 </label>
				 
				
		<label class="label">Propietario:
		   <input type="text" maxlength="100" id="propietario_otro1_edit"/>
		</label>
				
				
		<label class="label">Direccion:
			<input type="text" maxlength="450" id="direccion_otro1_edit" />
         </label>
				
				 
		<label class="label">Telefono:
			<input type="text" maxlength="50" id="telefono_otro1_edit" />
		</label>
				 
     </div>
				


   <br/>


	 <div data-role="fieldcontain">
		<label class="label">vehiculo 2:
		</label>
				
        <label class="label">Marca:
		<input type="text" maxlength="50" id="marca_otro2_edit" />
		</label>
				
		<label class="label">Tipo:
		<input type="text" maxlength="50" id="tipo_otro2_edit" />
		</label>
						 
		<label class="label">Placa:
		<input type="text" maxlength="50" id="placa_otro2_edit" />
		</label>
				 	
		<label class="label">Daño:
		<input type="text" maxlength="50" id="danio_otro2_edit" />
		</label>
				 	 
		<label class="label">Propietario:
		<input type="text" maxlength="50" id="propietario_otro2_edit" />
		</label>
				
		<label class="label">Direccion:
		<input type="text" maxlength="250" id="direccion_otro2_edit" />
		</label>
				 	 
		<label class="label">Telefono:
		<input type="text" maxlength="50" id="telefono_otro2_edit" />
		</label>
				 
      </div>
						
		<br/>
				

	<div data-role="fieldcontain">
	   <label class="label">vehiculo 3:
	   </label>
				
				
       <label class="label">Marca:
		<input type="text" maxlength="50" id="marca_otro3_edit" />
	   </label>
				
				
		<label class="label">Tipo:
		<input type="text" maxlength="50" id="tipo_otro3_edit" />
		</label>
				
				 
		<label class="label">Placa:
		<input type="text" maxlength="50" id="placa_otro3_edit" />
		</label>
				 
				
		<label class="label">Daño:
		<input type="text" maxlength="50" id="danio_otro3_edit" />
		</label>
				 
				  
				  
		<label class="label">Propietario:
		<input type="text"  maxlength="50" id="propietario_otro3_edit" />
		</label>
				
				
		<label class="label">Direccion:
		<input type="text" maxlength="250" id="direccion_otro3_edit" />
		</label>
				
				
				 
		<label class="label">Telefono:
		<input type="text" maxlength="50" id="telefono_otro3_edit" />
		</label>
				 
      </div>
				
				
				
	<br/>
				

      <div data-role="fieldcontain">
	   <label class="label">vehiculo 4:</label>
				
       <label class="label">Marca:
		<input type="text" maxlength="50" id="marca_otro4_edit" />
	   </label>
				
		<label class="label">Tipo:
		<input type="text" maxlength="50" id="tipo_otro4_edit" />
		</label>
				
				 
		<label class="label">Placa:
		<input type="text" maxlength="50" id="placa_otro4_edit" />
		</label>
				 
				
		<label class="label">Daño:
		<input type="text" maxlength="50" id="danio_otro4_edit" />
		</label>
				 
		<label class="label">Propietario:
		<input type="text" maxlength="50" id="propietario_otro4_edit" />
		</label>
					 
		<label class="label">Direccion:
		<input type="text" maxlength="250" id="direccion_otro4_edit" />
		</label>
				 
		<label class="label">Telefono:
		<input type="text" maxlength="50" id="telefono_otro4_edit" />
		</label>
				 
       </div>

</div>
</div>


<div data-role="collapsible" name="Datos_Pasajeros">
       
<h3>Datos Pasajeros</h3>
<div>

      <div data-role="fieldcontain">
			   
		<label class="label">vehiculo Compañia</label>
				
        <label class="label">Nombre:
		<input type="text" maxlength="100" id="nombre_pas_edit" />
		</label>
						
		<label class="label">Identificacion:
		<input type="text" maxlength="50" id="identificacion_pas_edit" />
		</label>
					 
		<label class="label">Direccion:
		<input type="text" maxlength="450" id="direccion_pas_edit" />
		</label>
				 	
		<label class="label">Telefono:
		<input type="text" maxlength="50" id="telefono_pass_edit" />
		</label>
					 
		<label class="label">vehiculo:
		<input type="text" maxlength="50" id="vehiculo_pass_edit" />
		</label>
				 
      </div>
				
        <br/>


      <div data-role="fieldcontain">
				 
		<label class="label">vehiculo 1</label>
				
        <label class="label">Nombre:
		<input type="text" maxlength="100" id="nombre_pas1_edit" />
		</label>
					
		<label class="label">Identificacion:
		 <input type="text" maxlength="50" id="identificacion_pas1_edit" />
		</label>
				 
		<label class="label">Direccion:
		<input type="text" maxlength="450" id="direccion_pas1_edit" />
		</label>
				 	
		<label class="label">Telefono:
		<input type="text"  id="telefono_pas1_edit" maxlength="50" />
		</label>
				 
		<label class="label">vehiculo:
		<input type="text" maxlength="50" id="vehiculo_pass1_edit" />
		</label>
				 
        </div>
				
        <br/>
				

     <div data-role="fieldcontain">
				 
		<label class="label">vehiculo 2</label>
				
        <label class="label">Nombre:
		<input type="text" maxlength="100"  id="nombre_pas2_edit" />
		</label>
				 
		<label class="label">Identificacion:
		<input type="text" maxlength="50"  id="identificacion_pas2_edit" />
		</label>
					 
		<label class="label">Direccion:
		<input type="text" maxlength="450" id="direccion_pas2_edit" />
		</label>
				 	
		<label class="label">Telefono:
		<input type="text" maxlength="50" id="telefono_pas2_edit" maxlength="50" />
		</label>
				 
		<label class="label">vehiculo:
		<input type="text" maxlength="50" id="vehiculo_pass2_edit" />
		</label>
				 
      </div>

</div>
</div>


<div data-role="collapsible" name="Testigos">
       
<h3>Testigos</h3>
<div>

        <div data-role="fieldcontain">
         <label class="label">Nombre:
		 <input type="text"  maxlength="150" id="nombre_testigo_edit" />
		 </label>
				  
		 <label class="label">Identificacion:
		 <input type="text" maxlength="50" id="identificacion_testigo_edit" />
		 </label>
				 
		 <label class="label">Direccion:
		 <input type="text"  maxlength="450" id="direccion_testigo_edit" />
		 </label>
				 	
		 <label class="label">Telefono:
		 <input type="text" maxlength="50" id="telefono_testigo_edit" />
		 </label>
				 
        </div>


     <br/>
				 
		<div data-role="fieldcontain">
        <label class="label">Nombre:
		<input type="text" maxlength="150"  id="nombre_testigo1_edit" />
	    </label>
					
		<label class="label">Identificacion:
		<input type="text" maxlength="50"  id="identificacion_testigo1_edit" />
		</label>
					 
		<label class="label">Direccion:
		<input type="text" maxlength="450"  id="direccion_testigo1_edit" />
		</label>
				 	
		<label class="label">Telefono:
		<input type="text" maxlength="50"   id="telefono_testigo1_edit" />
		</label>
				 
        </div>
                 
</div> 
</div>


<div data-role="collapsible" name="Lesionados">
       
<h3>Lesionados</h3>

<div> 

            <div data-role="fieldcontain">
            <label class="label">Conductor Veh Cia </label>
			</div>
			  
            <div data-role="fieldcontain">
             <label class="label">Nombre:
		     <input type="text" maxlength="100" id="nombre_lesionados_edit" />
		     </label>
				
			 <label class="label">Identificacion:
			 <input type="text" maxlength="50" id="identificacion_lesionados_edit" />
		     </label>
				
			 <label class="label">Direccion:
			 <input type="text" maxlength="450"  id="direccion_lesionados_edit" />
			 </label>
				 
			 <label class="label">Tipo Lesion:
			 <input type="text" maxlength="450" id="tipo_lesion_edit" />
			 </label>
				
            </div>
			
		<br/>

            <div data-role="fieldcontain">
            <label class="label">Pasajero Veh Cia </label>
			</div>
				
			<div data-role="fieldcontain">
              <label class="label">Nombre:
			  <input type="text" maxlength="100"  id="nombre_lesionados1_edit" />
			  </label>
				
			  <label class="label">Identificacion:
			  <input type="text" maxlength="50" id="identificacion_lesionados1_edit" />
			  </label>
				
			  <label class="label">Direccion:
			  <input type="text" maxlength="450" id="direccion_lesionados1_edit" />
			  </label>
				
			  <label class="label">Tipo Lesion:
			  <input type="text" maxlength="450" id="tipo_lesion1_edit" />
			 </label>
				
            </div>
				
			<br/>
			
			 <div data-role="fieldcontain">
              <label class="label">Conductor Veh 1 </label>
			  </div>
				
			 <div data-role="fieldcontain">
                <label class="label">Nombre:
			    <input type="text" maxlength="100"  id="nombre_lesionados2_edit" />
			    </label>
				
				
			   <label class="label">Identificacion:
			   <input type="text" maxlength="50" id="identificacion_lesionados2_edit" />
			   </label>
				 
				 
			   <label class="label">Direccion:
			   <input type="text" maxlength="450" id="direccion_lesionados2_edit" />
			   </label>
				
				
			   <label class="label">Tipo Lesion:
			   <input type="text" maxlength="450" id="tipo_lesion2_edit" />
		       </label>
				
            </div>
				
		  <br/>	
		  
		  
		        <div data-role="fieldcontain">
                 <label class="label">Pasajero Veh 1 </label>
			     </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados3_edit" />
				 </label>
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados3_edit" />
				 </label>
				
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados3_edit" />
				 </label>
				
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion3_edit" />
				 </label>
				 
                </div>
				
				
				
				
				<br/>
				 <div data-role="fieldcontain">
                  <label class="label">Conductor Veh 2 </label>
			     </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados4_edit" />
				 </label>
				
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados4_edit" />
				 </label>
				
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados4_edit" />
				 </label>
				
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion4_edit" />
				 </label>
				 
				 
                </div>
				
				
		  	   <br/>
				 <div data-role="fieldcontain">
                  <label class="label">Pasajero Veh 2 </label>
			      </div>
				
				<div data-role="fieldcontain">
                 <label class="label">Nombre:
				  <input type="text" maxlength="100"  id="nombre_lesionados5_edit" />
				 </label>
				
				
				 <label class="label">Identificacion:
				  <input type="text" maxlength="50" id="identificacion_lesionados5_edit" />
				 </label>
				
				
				 <label class="label">Direccion:
				  <input type="text" maxlength="450" id="direccion_lesionados5_edit" />
				 </label>
				
				
				 <label class="label">Tipo Lesion:
				  <input type="text" maxlength="450" id="tipo_lesion5_edit" />
				 </label>
				 
				 
				 
                </div>
				
		  	    <br/>
				
				<div data-role="fieldcontain">
				  <label class="label">Peaton: </label><br>
                   <label class="label">Nombre:
				   <input type="text" maxlength="100" id="nombre_peaton_edit" />
				   </label>
				 
				 <label class="label">Identificacion:
				  <input type="text"  maxlength="50" id="identificacion_peaton_edit" />
				 </label>
				
				 <label class="label">Direccion:
				  <input type="text"  maxlength="450" id="direccion_peaton_edit" />
				 </label>
				
				 <label class="label">Tipo Lesion:
				  <input type="text"  maxlength="450" id="tipo_lesion_peaton_edit" />
				 </label>
				 
                </div>
		  
	  
</div>
</div> 


<div data-role="collapsible" id="Relato_edit">
       
<h3>Relato</h3>
<div>

<div data-role="fieldcontain">
   <label class="label">Relato:
	<textarea type="text" id="relato_acc_edit" rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="800" required></textarea>
 </label>
				 
 </div>

</div>
</div>


<div data-role="collapsible" id="Fotos_edit">
       
<h3>fotos</h3>

<div>


 <form method="post" action="" enctype="multipart/form-data" id="myform_editAcc">
      <input type="file" id="file_editAcc" name="file" />
       <input type="button" class="button" value="Upload" id="but_upload_editAcc"/>
  </form>
 
 <div class="container_editAcc"></div>


</div>
</div>

	
<div data-role="collapsible" id="sign_edit">
       
<h3>Firma</h3>

<div>

<div data-role="fieldcontain">
<label>Firma Conductor:</label>

<img  id="visor_firma_edit" src="images/ajax-loader.gif" width="100px" height="100px" border="1px"/>


<br/>

 
</div>

</div>
</div>
	
			

<button id="btn_update_acc_edit" data-theme="a" data-icon="gear" style="background-color:#5ac8fa;">Actualizar</button>
<button id="btn_cancel_acc_edit" data-theme="a" data-icon="delete" style="background-color:#c1e2d3;">Cancelar</button>
  
 
</div>

</div>






<div id="tableContaineraccidente" style="overflow-y:scroll;height:80%;">
<table data-role="table" data-mode="reflow" class="ui-responsive" id="gridviewAccidentes">
  <thead>
    <tr  style="border-bottom: 1px solid #d6d6d6;">
       <th>#</th>
         <th data-priority="1">Unidad</th>
         <th data-priority="2">Registrado</th>
         <th data-priority="3">Edicion</th>
         <th data-priority="4">Cancelar</th>
    </tr>
  </thead>
  <tbody id="tb_historicoAccidente">
  </tbody>
</table>
</div>



</div>

</div>


<!-- fin de pagina de historial accidente -->

 

 
 <!--pagina Recepcion Entrega-->

<div data-role="page" class="paginas" id="pg_recepcionEntrega">

<div data-role="header" style="height: 55px;">
 <button id='atras_recepecion_entrega'>Atras</button>
 <h1>Recepcion - Entrega Vehiculo</h1>
</div>




<div data-role="popup" id="viewPictures" data-dom-cache="true" data-position-to="window" data-transition="turn" style="width:350px;height:320px;">

<a href="#" data-rel="back" class="ui-btn ui-btn-right ui-btn-b ui-btn-icon-notext ui-icon-delete ui-corner-all">Close</a>

<div>
<img style="width:300px;height:295px;background-color:#d5f4e6;margin-left:10px;margin-top:10px;" 
id="imagen_popup" src="images/ajax-loader.gif" />
<button id="giro_imagen" style="display:inline-block" data-theme="b" class="ui-btn ui-icon-forward ui-btn-icon-notext ui-corner-all"></button>
</div>

</div>





<div data-role="content" id="ContendorEntregaRecepcion">


<div data-role="collapsible" id="Datos_generales_en">    
<h3>Datos Generales</h3>
<div>

<div id="nuevoscampos">

<div data-role="fieldcontain"> 
<label>No.Registro
<input type="text" maxlength="100" id="no_registro"/>
</label>
</div>
<br/>
<div data-role="fieldcontain"> 
<label>Referencia
<input type="text" maxlength="100" id="referencia"/>
</label>
</div>
<br/>



<div data-role="fieldcontain" id="contendorMiSelect_un"> 
<label class="select">Unidad<a style="color:red;">*</a>
<select id="select_unidad_en"></select>
</label>
</div>

<br/>
<div data-role="fieldcontain" id="contendorMiSelect_gestion">
<label class="select">Tipo<a style="color:red;">*</a>
<select id="select_tipo_en">
<option value="1">Entrega</option>
<option value="2">Recepcion</option>
</select>
</label>
</div>

</div>
<br/>

<div class="table-wrapper-scroll-y my-custom-scrollbar">
<table data-role="table"   data-mode="reflow" class="ui-responsive" id="my-table-en">
 <thead>
       <tr>
	     <th>#</th>
	     <th>Item</th>
         <th></th>
       </tr>
 </thead>
	  <tbody id='tbody_items_en'>
      </tbody>
</table>
 </div>  
   
 </div>
</div>  

<div data-role="collapsible" id="Detalles_en">     
<h3>Detalles</h3>
<div>

<div data-role="fieldcontain">
<label>Kilometraje <a style="color:red;">*</a>
<input type="number" id="km_inicial"/>
</label>
</div>

<div data-role="fieldcontain">
<label>Combustible <a style="color:red;">*</a>
<input type="text" id="combustible" maxlength="100"/>
</label>
</div>

<div data-role="fieldcontain">
<label>Nombre tipo bateria <a style="color:red;">*</a>
<input type="text"  id="tipo_bateria" maxlength="100"/>
</label>
</div>

<div data-role="fieldcontain">
<label>Nombre entrego <a style="color:red;">*</a>
<input type="text" id="nombre_entrego" maxlength="100"/>
</label>
</div>

<div data-role="fieldcontain">
<label>Identificacion entrego <a style="color:red;">*</a>
<input type="text" id="identificacion_entrego"  maxlength="100"/>
</label>
</div>


<div data-role="fieldcontain">
<label>Nombre recibe <a style="color:red;">*</a>
<input type="text"  id="nombre_recibe" maxlength="100"/>
</label>
</div>

<div data-role="fieldcontain">
<label>Identificacion recibe <a style="color:red;">*</a>
<input type="text"   id="identificacion_recibe" maxlength="100"/>
</label>
</div>

<div data-role="fieldcontain">
<label>observacion
<textarea type="text" id="observacion_en"  rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="800" required></textarea>
</label>
</div>

</div>
</div>

<div data-role="collapsible" id="Datos_fotos_en">     
<h3>Fotos</h3>
<div>



<div data-role="fieldcontain">
 <br>
				 
     <form method="post" action="" enctype="multipart/form-data" id="myform_en">
     <input type="file" id="file_en" name="file" />
     <input type="button" class="button" value="Upload" id="but_upload_en">
     </form>
 
<!-- Image element container -->
<div class="containerFile"></div>
				
</div>


</div>
</div>

<div data-role="collapsible" id="Firmas_en">     
<h3>Firmas</h3>
<div>

<div data-role="fieldcontain">
 <label>Firma Entrega: <a style="color:red;">*</a></label><br><br>
 <div id="signature_en" style='width:180px; height:180px; border: 1px solid black;'>
  <canvas id="signature-pad_en" class="signature-pad" width="180px" height="180px"></canvas>
 </div>
 <br/>
 <a href='#' id='clear_en'>Clear</a>
 <label>Aceptar Firma  <input type="checkbox"  id="saved_signed_en" value="Car"/></label>
 
 <br/>					
</div>

<br>
<div data-role="fieldcontain">
<label>Firma Recibido: <a style="color:red;">*</a> </label><br><br>

<div id="signature_re" style='width:180px; height:180px; border: 1px solid black;'>
 <canvas id="signature-pad_re" class="signature-pad" width="180px" height="180px"></canvas>
</div>

<br/>
 <a href='#' id='clear_re'>Clear</a>
 <label>Aceptar Firma  <input type="checkbox"  id="saved_signed_re" value="Car"/></label>
<br/>

</div>

</div>
</div>


<br><br><br>
	
<button  id="BtnGuardarEn" class="ui-btn" class="center-button" style="background-color:#5ac8fa;width:50%; margin: 0 auto;">Guardar</button> 
  
</div>

<div data-role="footer" data-position="fixed">
<label>Campos obligatorios <a style="color:red;">*</a></label>
</div>

</div>


<!--Fin Recepcion Entrega-->

 
 
<!--pagina Historial Recepcion Entrega-->

<div data-role="page" class="paginas" id="historialEntrega">

  <div data-role="header" style="height: 55px;" >
    <button id='atras_historialEN'>Atras</button>
     <h1>Historial Recepcion Entrega</h1>
  </div>


<div data-role="content">

      <div data-role="popup" id="popupEdit_entrega" data-theme="a" style="width:90%;" class="ui-corner-all">
        <div style="padding:10px 20px;">
          <h3>Actualizar</h3>
          <label id="id_update_entrega" style="display:none;"></label>
		  
            <div data-role="collapsible" id="Datos_generales_edit_en"> 
               <h3>Datos Generales</h3>
          <div>

          <div data-role="fieldcontain"> 
          <label>No.Registro
          <input type="text" maxlength="100" id="edit_no_registro"/>
          </label>
           </div>
          <br/>
          <div data-role="fieldcontain"> 
          <label>Referencia
           <input type="text" maxlength="100" id="edit_referencia"/>
          </label>
          </div>
           <br/>








            <div data-role="fieldcontain"> 
            <label class="select">Unidad
            <select id="select_edit_unidad_en"></select>
            </label>
            </div>

             <div data-role="fieldcontain">
            <label class="select">Tipo
            <select id="select_edit_tipo_en">
            <option value="1">Entrega</option>
            <option value="2">Recepcion</option>
            </select>
            </label>
            </div>
<div class="table-wrapper-scroll-y my-custom-scrollbar">			
  <table data-role="table"   data-mode="reflow" class="ui-responsive" id="my-table-edit_en">
             <thead>
                   <tr>
            	     <th>#</th>
            	     <th>Item</th>
                     <th></th>
                   </tr>
             </thead>
            	  <tbody id='tbody_items_edit_en'>
                  </tbody>
               </table>
 </div>
         </div>
       </div>






<div data-role="collapsible" id="Datos_detalle_edit_en">
                   
         <h3>Detalles</h3>
          <div>
		  
            <div data-role="fieldcontain">
            <label>Kilometraje
            <input type="number" id="edit_km_inicial"/>
            </label>
            </div>

            <div data-role="fieldcontain">
            <label>Combustible
            <input type="text" id="edit_combustible" maxlength="100"/>
            </label>
            </div>

            <div data-role="fieldcontain">
            <label>Nombre_tipo_bateria
            <input type="text"  id="edit_tipo_bateria" maxlength="100"/>
            </label>
            </div>

            <div data-role="fieldcontain">
            <label>Nombre_entrego
            <input type="text" id="edit_nombre_entrego" maxlength="100"/>
            </label>
            </div>

            <div data-role="fieldcontain">
            <label>Identificacion_entrego
            <input type="text" id="edit_identificacion_entrego"  maxlength="100"/>
            </label>
            </div>

            <div data-role="fieldcontain">
            <label>Nombre_recibe
            <input type="text"  id="edit_nombre_recibe" maxlength="100"/>
            </label>
            </div>

            <div data-role="fieldcontain">
            <label>Identificacion recibe
            <input type="text"   id="edit_identificacion_recibe" maxlength="100"/>
            </label>
            </div>

            <div data-role="fieldcontain">
            <label>observacion
            <textarea type="text" id="edit_observacion_en"  rows="4" cols="50" style="width:80%; margin: 0 auto;" maxlength="800" required></textarea>
            </label>
            </div>
				
			 </div>
			 </div>	
				
				
				
				
<div data-role="collapsible" id="Datos_fotos_edit_en">             
  <h3>Fotos</h3>
    <div>
           <div data-role="fieldcontain">
             <br>
            				 
            <form method="post" action="" enctype="multipart/form-data" id="myform_edit_en">
            <input type="file" id="file_edit_en" name="file" />
            <input type="button" class="button" value="Upload" id="but_upload_edit_en">
            </form>
             
            <!-- Image element container -->
            <div class="containerFileEdit"></div>
            				
           </div>


    </div>
 </div>
				
	

<div data-role="collapsible" id="Firmas_en_edit">
                   
            <h3>Firmas</h3>

            <div>

            <div data-role="fieldcontain">
             <label>Firma Entrega:</label><br><br>
             <img src="images/ajax-loader.gif" id="visor_firma_en" height="100px" width="100px">
             <br/>
			 
             <br/>					
            </div>
            <br>
            <div data-role="fieldcontain">
            <label>Firma Recibido:</label><br><br>
             <img src="images/ajax-loader.gif" id="visor_firma_re" height="100px" width="100px">
            <br/>
          
            </div>
      </div>
</div>
	

<button id="btn_update_en_edit" data-theme="a" data-icon="gear" style="background-color:#5ac8fa;">Actualizar</button>
  
<button id="btn_cancel_en_edit" data-theme="a" data-icon="delete" style="background-color:#c1e2d3;">Cancelar</button>
  
  </div>


</div>








<div id="tableContainerEntrega" style="overflow-y:scroll;height:80%;">
<table data-role="table" data-mode="reflow" class="ui-responsive" id="gridviewEntrega">
  <thead>
    <tr  style="border-bottom: 1px solid #d6d6d6;">
       <th>Registrado</th>
         <th data-priority="1">Unidad</th>
         <th data-priority="2">Edicion</th>
         <th data-priority="3">Cancelar</th>
    </tr>
  </thead>
  <tbody id="tb_historicoEntrega">
  </tbody>
</table>
</div>
</div>

</div>


<!--Fin pagina Historial Recepcion Entrega-->

 
 
 
 

<div data-role="page"  class="paginas" id="myaccount">

<div data-role="header" style="height: 55px;" >
<button id='atras_acon'>Atras</button>
   <h3><label>Mi cuenta</label></h3>
</div>



  <div data-role="content">
  
  <div id="main_myaccount">
         <label style="text-transform:lowercase;">Actualizar usuario:</label>
         <label  style="text-transform:lowercase;" id="usr_update"></label>


         <div data-role="fieldcontain">
         <label style="text-transform:lowercase;"><strong>Actualizar contraseña</strong></label><br>

         <label style="text-transform:lowercase;">contraseña Actual</label>
         <input type="password" id="password_actual"/>

         <label style="text-transform:lowercase;">Nueva contraseña</label>
         <input type="password" id="password_nuevo" /><br>

         <button style="background-color:#5ac8fa;" id="btn_password">Actualizar contraseña</button>
         </div>

</div>
</div>


</div>
 
 
 
<script type="text/javascript">

document.oncontextmenu = function(){return false;}




var id_usuario;
var logeado;
var email_activo;
var pwd_insertado;
var direccion_activa;
var empresa_activa='';
var id_session='';

var ArrayPais=[];
var ArrayIdPais=[];


var ArrayIdDept=[];
var ArrayNombreDept=[];
var ArrayPaisDept=[];

var ArregloInsertFotos=[];

var dataURL_img;


$(document).on('pagebeforechange', function (e, data) {
    var to = $.mobile.path.parseUrl(data.toPage);
    if (typeof to === 'object') {
        var u = to.href;
        if (u === $.mobile.navigate.history.stack[0].url) {
            //alert('You are logged in!');
            var current = "#" + $.mobile.pageContainer.pagecontainer("getActivePage")[0].id;
            window.location.hash += current;
            return false;
        }
    }
});




//controlador de aplicacion

if ((performance.navigation.type == 1)||(performance.navigation.type == 2)) {
    //recargamos
	 $.mobile.changePage("#inicio");
	   id_usuario="";
      localStorage.setItem("appkey_usr", '');
      id_session='';
	  window.location="#";
}
  
  
   
$(document).on('pagebeforechange', function(e, data){
    var to = data.toPage,
        from = data.options.fromPage;

    if (typeof to  === 'string') {
        var u = $.mobile.path.parseUrl(to);
        to = u.hash || '#' + u.pathname.substring(1);
        if (from) from = '#' + from.attr('id');


        //console.log('desde::'+from+', hacia:'+to);


        if (from === '#inicio' && to ==='#home') {
          if($("#nombredeusuario").val()===""){

           //console.log('no podes ir a home sin estar logeado');
            e.preventDefault();
            e.stopPropagation();
          }
        }



        if (to ==='#home'){
          if($("#nombredeusuario").val()===''){
           //console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }
		
		
		 if (to ==='#pg_insertChecklist'){
          if($("#nombredeusuario").val()===''){
          // console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }
		
		if (to ==='#historialCheck'){
          if($("#nombredeusuario").val()===''){
           //console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }
		
		
		
		if (to ==='#pg_insertAccidente'){
          if($("#nombredeusuario").val()===''){
           //console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }
		
	
		
		if (to ==='#pg_historialAccidente'){
          if($("#nombredeusuario").val()===''){
           //console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }



	if (to ==='#pg_recepcionEntrega'){
          if($("#nombredeusuario").val()===''){
           //console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }
		
	
		
		if (to ==='#historialEntrega'){
          if($("#nombredeusuario").val()===''){
           //console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }
		
		
		
       if (to ==='#myaccount'){
          if($("#nombredeusuario").val()===''){
           //console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
        }



    }
});

 

$(document).on("pagebeforeshow","#inicio",function(){
   id_usuario='';
   localStorage.setItem("appkey_usr", '');
   $.mobile.changePage("#inicio");
   id_session='';

   //console.log('datos vacios');
});



$(document).on("pagebeforeshow","#home",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});

$(document).on("pagebeforeshow","#pg_insertChecklist",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});

$(document).on("pagebeforeshow","#historialCheck",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});
 
$(document).on("pagebeforeshow","#pg_insertAccidente",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});
 
$(document).on("pagebeforeshow","#pg_historialAccidente",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});
  
$(document).on("pagebeforeshow","#pg_recepcionEntrega",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});
  
$(document).on("pagebeforeshow","#historialEntrega",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});
  
$(document).on("pagebeforeshow","#myaccount",function(){

var temporal_usr=$("#nombredeusuario").val();
//console.log('evento a la escucha de antes de cargar historial:'+temporal_usr);
   if(temporal_usr===''){
         //  console.log('direccionado por to de pagebeforechange');
		   $.mobile.changePage("#inicio");
          }
});
  
 


$("#password_ver").bind("tap", function() {
        if ($('#clave').attr('type') == 'text') {
              $('#clave').attr('type', 'password');
			  // $(this).attr('data-theme', 'a').trigger('create');
			   
          } else {
             $('#clave').attr('type', 'text');
			 //$(this).attr('data-theme', 'b').trigger('create');
          }
});



$('#btnOlvide').bind("tap", function() {
var datosUsuario = $("#nombredeusuario").val();
if(datosUsuario==''){
   $.alert({title: 'Error!',content:'ingresa el nombre de usuario'});
}else{
  $.confirm({
      title: 'Importante!',
      content: '¿deseas recuperar tu acceso?',
      buttons: {
       confirm: function () {
            $.ajax({
                 type: "POST",
                 url: "http://191.98.228.86/ApiRestTTMS/olvideAcceso",
                 data: { "usuario": datosUsuario},
                 beforeSend: function() {
                          $.mobile.loading('show');
                      },
                 success: function (data) {
                           $.mobile.loading('hide');
                           $.alert({title: 'alerta!',content: data.mensaje});
                       },
                error: function (jqXHR, textStatus, errorThrown) {
                          var errorResponse='';
	               if (jqXHR.status === 0) {
                    errorResponse='Not connect: Verify Network.';
                   } else if (jqXHR.status == 404) {
                    errorResponse='Requested page not found [404]';
                   } else if (jqXHR.status == 500) {
                    errorResponse='Internal Server Error [500].';
                  } else if (textStatus === 'parsererror') {
                    errorResponse='Requested JSON parse failed.';
                  } else if (textStatus === 'timeout') {
                    errorResponse='Time out error.';
                  } else if (textStatus === 'abort') {
                   errorResponse='Ajax request aborted.';
                  } else {
                   errorResponse='Uncaught Error: ' + jqXHR.responseText;
                  }

	               $.alert({title: 'Error!',content:errorResponse});

                   }
                });
        },
        cancel: function () {
            $.alert('Sin accion!');
        }
    }
});

}//si el usuario es valido

});





//---------------   globales de sesion --------

var Temporizador;
var myTimer;

function ResetTemporizador(){
if(id_usuario!=''){

if(Temporizador){
   clearTimeout(Temporizador);
 }
Temporizador = setTimeout( ShowTimeoutWarning,300000);
//console.log('resetado temporizador');
}
};


function ShowTimeoutWarning() {

   $.confirm({
    title:'Sesion Expirada',
    content:'Saliendo en 10 segundos, deseas continuar?',
	autoClose: 'cancel|10000',
    buttons:{
        confirm: function () {
           ResetTemporizador();
        },
        cancel: function () {
           clearInterval(myTimer);
           clearTimeout(Temporizador);
		   id_usuario='';
           localStorage.setItem("appkey_usr", '');
           $.mobile.changePage("#inicio");  
        }
    }
});

}//fin de wargin de sesion finalizada


$("#body").keydown(function() {
  ResetTemporizador();
});

$("#body").click(function() {
  ResetTemporizador();
});




function ValidarSession(id_usuario,id_session){

//consultamos  a la api
$.ajax({
          type: "POST",
           url: "http://191.98.228.86/GestionFlota_ApiRest/ValidarSession",
            data: {"id_usuario": id_usuario,"id_session": id_session},
             success: function (data) {
              if (data){
				 if(data.activo==1){
				 }else{
             $.confirm({
             title:'Ha iniciado sesion mismo usuario',
             content:'Cerrando sesion',
	         autoClose: 'confirm|5000',
             buttons:{
                confirm: function () {
		         clearInterval(myTimer);
		         id_usuario='';
                 localStorage.setItem("appkey_usr", '');
                 $.mobile.changePage("#inicio");  
               }
             }
          });
					
                  }
				  }
                  },
                      error: function (xhr, status, error) {
                     var texto_error="ERROR - xhr.status: " + xhr.status + '<br>xhr.responseText: ' + xhr.responseText + '<br>xhr.statusText: ' + xhr.statusText + '<br>Error: ' + error + '<br>Status: ' + status;
                    
                  }
             });//fin de ajax


};


//-----------------------------------------------












/*--------Inicio------*/

$('#formulario').submit(function() {

    event.preventDefault();

  var datosUsuario = $("#nombredeusuario").val();
  var datosPassword = $("#clave").val();
  datosPassword=datosPassword.replace(/ /g, "");
  pwd_insertado=datosPassword;


    $.ajax({
        type: "POST",
        url: "http://191.98.228.86/GestionFlota_ApiRest/login",
        cache: false,
        data: {"usuario":datosUsuario,"password":datosPassword},
         beforeSend: function() {
            $.mobile.loading('show');
          },
        success: function (respuestaServer) {
           $.mobile.loading('hide');
         var mensaje=respuestaServer.mensaje + "\nGenerado en: " + respuestaServer.hora + "\n" +respuestaServer.generador;
         
		 //console.log(respuestaServer.id);
		 
          if(respuestaServer.validacion == "ok"){
		  
		  $.alert({title: 'Bienvenido:',content: mensaje});
		  
	          logeado=datosUsuario;
              id_usuario=respuestaServer.id;
              email_activo=respuestaServer.correo;
              empresa_activa=respuestaServer.empresa;
              id_session=respuestaServer.id_session;

              localStorage.setItem("appkey_usr", logeado);
              $.mobile.changePage("#home");
	          CargarVehiculos();
              ResetTemporizador();

              myTimer=setInterval(function(){
                    ValidarSession(id_usuario,id_session);
                 },60000);

           }else{
		     $.alert({title: 'Alerta:',content: mensaje});
		   }
    },
    error: function (jqXHR, textStatus, errorThrown ) {
	
	       var errorResponse='';
	     if (jqXHR.status === 0) {
            errorResponse='Not connect: Verify Network.';
          } else if (jqXHR.status == 404) {
             errorResponse='Requested page not found [404]';
          } else if (jqXHR.status == 500) {
            errorResponse='Internal Server Error [500].';
          } else if (textStatus === 'parsererror') {
            errorResponse='Requested JSON parse failed.';
          } else if (textStatus === 'timeout') {
            errorResponse='Time out error.';
          } else if (textStatus === 'abort') {
            errorResponse='Ajax request aborted.';
          } else {
            errorResponse='Uncaught Error: ' + jqXHR.responseText;
          }

	       $.alert({title: 'Error!',content:errorResponse});
	}
    });


 return false;

});



/*  -----datos default ------ */

//cargando listado vehiculos

var ArrayFlota=[];
ArrayFlota.lenght=0;



function CargarVehiculos(){

ArrayFlota.lenght=0;

$('#unidad_edit').html("");
$('#select_unidad').html("");
$('#select_unidad_en').html("");

  $.ajax({
        type: "POST",
        url: "http://191.98.228.86/GestionFlota_ApiRest/listarVehiculos",
        data: {"empresa":empresa_activa},
        success: function (data) {
            $.each(data, function (index){
			
			   if (!data[0]){
                       $.alert({title: 'Error:',content: 'Sin Registros de vehiculos'});
                    }
			

               var id_ve=data[index].id;
               var nombre_ve=data[index].nombre_ve;
              
			   var vehiculo_item={
			   "id_ve":data[index].id,
			   "nombre_ve":data[index].nombre_ve,
			   "placa_ve":data[index].placa_ve,
			   "id_avl":data[index].id_avl,
			   "marca":data[index].marca,
			   "modelo":data[index].modelo,
			   "anio":data[index].anio,
			   "descripcion":data[index].descripcion,
			   };
			   
			   ArrayFlota.push(vehiculo_item);
			  
               $('#select_unidad').append('<option value="'+id_ve+'">'+nombre_ve+'</option>');
               $('#unidad_edit').append('<option value="'+id_ve+'">'+nombre_ve+'</option>');
               $('#select_unidad_en').append('<option value="'+id_ve+'">'+nombre_ve+'</option>');
			   $('#select_edit_unidad_en').append('<option value="'+id_ve+'">'+nombre_ve+'</option>');
			   
             });

      },error: function (jqXHR, textStatus, errorThrown) {
                      var errorResponse='';
	               if (jqXHR.status === 0) {
                    errorResponse='Not connect: Verify Network.';
                   } else if (jqXHR.status == 404) {
                    errorResponse='Requested page not found [404]';
                   } else if (jqXHR.status == 500) {
                    errorResponse='Internal Server Error [500].';
                  } else if (textStatus === 'parsererror') {
                    errorResponse='Requested JSON parse failed.';
                  } else if (textStatus === 'timeout') {
                    errorResponse='Time out error.';
                  } else if (textStatus === 'abort') {
                   errorResponse='Ajax request aborted.';
                  } else {
                   errorResponse='Uncaught Error: ' + jqXHR.responseText;
                  }

	               $.alert({title: 'Error!',content:errorResponse});
	 
	            CargarVehiculos();
	 }
 });


}//fin de funcion cargar vehiuclos


/*  -----------------__________________------------------------ */

/*  ----------------pagina de Checklist----------------------- */

/*  -----------------__________________------------------------ */


$('#link_agregarChecklist').bind("tap", function() {
if((id_usuario=='')||(empresa_activa=='')){
  $.mobile.changePage("#inicio");
 }else{
      $.mobile.changePage("#pg_insertChecklist");
	  CargarOpcionesChecklist();
      
}  
});


$('#atras_pg_nuevoCheck').bind("tap", function() {
    $.mobile.changePage("#home");
  
});

//-----     cargando listado items checklist------ 

var id_opcionArray=[];
var nombre_opcionArray=[];

function CargarOpcionesChecklist(){

 $("#km_unidad").val("");
$('#texoObservacion').val("");
 
$.mobile.loading('show');
 
$("#contendorTabla").hide();
$("#tbody_items").html("");

id_opcionArray.length=0;
nombre_opcionArray.lenght=0;
  

  $.ajax({
        type: "POST",
        url: "http://191.98.228.86/GestionFlota_ApiRest/listarOpcionesChecklist",
        data: {"empresa":empresa_activa},
        success: function (data) {
		   $.mobile.loading('hide');
		   $("#contendorTabla").show();
           var iteracion=1;
         $.each(data, function (index){
		 
		    if (!data[0]){
                       $.alert({title: 'Error:',content: 'Sin Registros de items '});
                    }
		
              var id_opcion=data[index].id_opcion;
              var nombre_opcion=data[index].nombre_opcion;
           
               id_opcionArray.push(id_opcion);
			   nombre_opcionArray.push(nombre_opcion);
			  
			 if(iteracion % 2 == 0) {
               var color='#F4F4F8';
              }else {
                 var color='#ede7f6';
              }
			
	 
		 
         $('#tbody_items').append('<tr id="'+id_opcion+'" value='+id_opcion+' class="id_row" style="background-color:'+color+'"><td>'+
		 iteracion+'</td><td>'+nombre_opcion+'</td><td><strong>'+
		 '<input type="checkbox" name="SI" class="check_'+id_opcion+'" value="1" style="margin-left:15px;">SI'+
		 '<input type="checkbox" name="NO" value="2" class="check_'+id_opcion+'" style="margin-left:15px;">NO</input>'+
		 '<input type="checkbox" name="N/A" value="3" class="check_'+id_opcion+'" style="margin-left:15px;">N/A</input>'+
		 '<input type="checkbox" name="Alerta" value="4"  class="check_'+id_opcion+'" style="margin-left:15px;">Alerta</input></strong></td><tr>' );
         iteracion++;
            

			});

       $("#my-table-options").table("refresh");
	   
      },error: function (jqXHR, textStatus, errorThrown){
	                  var errorResponse='';
	               if (jqXHR.status === 0) {
                    errorResponse='Not connect: Verify Network.';
                   } else if (jqXHR.status == 404) {
                    errorResponse='Requested page not found [404]';
                   } else if (jqXHR.status == 500) {
                    errorResponse='Internal Server Error [500].';
                  } else if (textStatus === 'parsererror') {
                    errorResponse='Requested JSON parse failed.';
                  } else if (textStatus === 'timeout') {
                    errorResponse='Time out error.';
                  } else if (textStatus === 'abort') {
                   errorResponse='Ajax request aborted.';
                  } else {
                   errorResponse='Uncaught Error: ' + jqXHR.responseText;
                  }

	               $.alert({title: 'Error!',content:errorResponse});
	 
	              CargarOpcionesChecklist();
	     }
	  });


	  
	  
	  
	  
	  
	//a la escucha de clic en items de la tabla
	
$("#my-table-options").on('change',"input[type='checkbox']",function(e){
    //your code 
	
	var title = $(this).attr('name');//atributo nombre del check
    var trid = $(this).parents('tr:first').attr('id'); // id de fila contenido
	
	var itemSeleccionado=$(this).val();
	
     //$.alert({title: 'mensaje:',content: 'name:'+title+', item:'+trid});
		 
	
	//verifica que solo el que acabamos de poner quede activo
	$('input.check_'+trid+':checkbox:checked').each(function () {
	     var Valoriteracion = $(this).val();
		 
	     if(itemSeleccionado!=Valoriteracion){
		 $(this).prop( "checked", false );
		 } 
     }); 
});


	  
}//fin de funcion carga checklist



var texto_sin_check='';

$('#BtnGuardarCheck').bind("tap", function() {
texto_sin_check='';
var arreglo_valorinsertar=[];
arreglo_valorinsertar.lenght=0;

var estado_po=0;

var NumeroItemTabla=0;
 
$('#my-table-options tr').each(function() {
 var item =this.id;
 var banderacheck=false;
   $('input.check_'+item+':checkbox:checked').each(function () {
       var Valoriteracion = $(this).val();
       if($(this).is(':checked')){
         estado_po=1;
         arreglo_valorinsertar.push(Valoriteracion);
         banderacheck=true;  
       }	      
    });

if((banderacheck==false)&&(NumeroItemTabla >0)&&($(this).find("td:eq(1)").text()!='')){
var cadena=$(this).find("td:eq(1)").text();
	texto_sin_check=texto_sin_check+',-'+cadena.substr(4);
   //console.log('valor columna:'+$(this).find("td:eq(1)").text());


	}	

NumeroItemTabla++;						  
 });


var datosPost=[];
datosPost.lenght=0;

 //  ---registrar checklist--- todo completado---------
if(id_opcionArray.length==arreglo_valorinsertar.length){

  for(i=0; i<id_opcionArray.length;i++){
      var arreglo= {};
      arreglo['id_opcion']=id_opcionArray[i];
      arreglo['valor']=arreglo_valorinsertar[i];
      arreglo['nombre']=nombre_opcionArray[i];
      datosPost.push(arreglo);
    }
	
var	aInfo 	= JSON.stringify(datosPost);
 
var unidad_enviar=$('#select_unidad').val();
var observacion_enviar=$('#texoObservacion').val();

var detalle_unidad=$("#select_unidad option:selected").text();

var km_unidad=$("#km_unidad").val();

if(km_unidad!=''){



$.confirm({
    title: 'Importante!',
    content: '¿deseas registrar checklist?',
    buttons: {
        confirm: function () {
            $.ajax({
                 type: "POST",
                 url: "http://191.98.228.86/GestionFlota_ApiRest/insertarChecklist",
                 data:{'array':aInfo, 
				 'usuario':id_usuario,
				 'unidad':unidad_enviar,
				 'empresa':empresa_activa,
				 'observacion':observacion_enviar, 
                 'km_unidad':km_unidad,
                 'detalle_unidad':detalle_unidad,
                 'id_session':id_session},
                  beforeSend: function() {
                          $.mobile.loading('show');
						  $("#texoObservacion").prop('disabled', true);
                      },
                      success: function (data) {
                           $.mobile.loading('hide');
                           $.alert({title: 'alerta!',content: data});
						  
						   if(data[0]=='Checklist registrado'){
						    $('#texoObservacion').val("");
						    $("#texoObservacion").prop('disabled', false);
                            $("#km_unidad").val("");
							
							//limpiar todos los input checkbox de tabla
							for(i=0; i<id_opcionArray.length;i++){
                                $('input.check_'+id_opcionArray[i]+':checkbox:checked').each(function () {
	                            $(this).prop( "checked", false );
		                         });
								 
                            }//fin de for de items
							
						   }//fin si fue registrado
                       },
                          error: function (jqXHR, textStatus, errorThrown){
	                        var errorResponse='';
	                        if (jqXHR.status === 0) {
                             errorResponse='Not connect: Verify Network.';
                           } else if (jqXHR.status == 404) {
                            errorResponse='Requested page not found [404]';
                            } else if (jqXHR.status == 500) {
                             errorResponse='Internal Server Error [500].';
                            } else if (textStatus === 'parsererror') {
                             errorResponse='Requested JSON parse failed.';
                            } else if (textStatus === 'timeout') {
                             errorResponse='Time out error.';
                           } else if (textStatus === 'abort') {
                             errorResponse='Ajax request aborted.';
                           } else {
                             errorResponse='Uncaught Error: ' + jqXHR.responseText;
                           }

	                    $.alert({title: 'Error!',content:errorResponse});
					   
                   }
                });

                 //fin de ajax
        },
        cancel: function () {
            $.alert('Sin accion!');
        }
    }
});


}else{
$.alert({title: 'mensaje:',content: 'Debes ingresar km actuales'});

}

}else{

//$.alert({title: 'mensaje:',content: 'Debes completar el checklist'});
$.alert({title: 'mensaje:',content: 'Debes completar el checklist: '+texto_sin_check});

}



});//fin de guardar checklist


//-----    detalles historicos de  checklist------ 

$('#link_historicoChecklist').bind("tap", function() {
if((id_usuario=='')||(empresa_activa=='')){
  $.mobile.changePage("#inicio");
 }else{
    $.mobile.changePage("#historialCheck");
	CargarHistorialCheck();
  
	}
});

$('#atras_hi_Check').bind("tap", function() {
    $.mobile.changePage("#home");
   
});

var id_filas_edicion=[]; id_filas_edicion.length=0;
var unidad_filas_edicion=[];unidad_filas_edicion.length=0;
var insert_filas_edicion=[];insert_filas_edicion.length=0;
var observacion_filas_edicion=[];observacion_filas_edicion.length=0;
var catalogo_item_edicion=[];catalogo_item_edicion.length=0;

//      -------historial checklist -----------

function CargarHistorialCheck(){

  $.mobile.loading('show');
  $("#tableContainer").hide();
  $('#tb_historico_check').html("");
  
 // console.log("usuario:"+id_usuario);

   $.ajax({
        type: "POST",
        url: "http://191.98.228.86/GestionFlota_ApiRest/HistoricosChecklist",
        data: { "empresa":empresa_activa,"usuario":id_usuario},
        success: function (data) {
		
		
		if (!data[0]){$.alert({title: 'Alerta:',content: 'Sin Registros de checklist'});};
		
		$.mobile.loading('hide');
		
		$("#tableContainer").show();

            var iteracion=1;
			
			id_filas_edicion.length=0;
            unidad_filas_edicion.length=0;
            insert_filas_edicion.length=0;
            observacion_filas_edicion.length=0;
			catalogo_item_edicion.length=0;

            $.each(data, function (index){

              var id_re=data[index].id_resumen;
			  var id_re_unidad=data[index].id_unidad;
			  var re_observacion=data[index].observacion;
			  var re_insertado=data[index].insertado;
			  var permiso_edicion=data[index].edicion;
			  var re_insertado=data[index].insertado;
			  var nombre_vehiculo_re;
			  
			  id_filas_edicion.push(id_re);
              unidad_filas_edicion.push(id_re_unidad);
			  observacion_filas_edicion.push(re_observacion);
              insert_filas_edicion.push(re_insertado);
			  catalogo_item_edicion.push(data[index].catalogo);
             
			 for(b=0; b < ArrayFlota.length; b++){
			    if(ArrayFlota[b]['id_ve']==id_re_unidad){
				nombre_vehiculo_re=ArrayFlota[b]['nombre_ve']+'-'+ArrayFlota[b]['placa_ve'];
				}
			 }
			 
			 if(iteracion % 2 == 0) {
               var color='#F4F4F8';
              }else {
                 var color='#ede7f6';
              }
			 
		if(permiso_edicion==1){
               $('#tb_historico_check').append('<tr id="'+id_re+'" value='+id_re+' style="background-color:'+color+'"><td>'+
	           iteracion+'</td><td><strong>'+nombre_vehiculo_re+'</strong></td><td>'+re_insertado+
              '</td><td>--</td><td><a href="" onClick="DeletedRow_Check('+id_re+')">Borrar</a></td></tr>');

//<a href="#popupEditCheck"  onClick="EditRow_check('+id_re+')"  data-rel="popup" data-position-to="window">Editar</a>
			  }else{
			     
				  $('#tb_historico_check').append('<tr id="'+id_re+'" value='+id_re+' style="background-color:'+color+'">'+
	                '<td>'+iteracion+'</td>'+
	                '<td>'+nombre_vehiculo_re+'</td><td>'+re_insertado+'</td><td>-</td><td>-</td></tr>');
			  }
			  
          iteracion++;
		 
       });//fin de foreach

      
	   
      },error: function (jqXHR, textStatus, errorThrown){
          var errorResponse='';
	          if (jqXHR.status === 0) {
                  errorResponse='Not connect: Verify Network.';
                 } else if (jqXHR.status == 404) {
                  errorResponse='Requested page not found [404]';
                 } else if (jqXHR.status == 500) {
                   errorResponse='Internal Server Error [500].';
                  } else if (textStatus === 'parsererror') {
                   errorResponse='Requested JSON parse failed.';
                  } else if (textStatus === 'timeout') {
                    errorResponse='Time out error.';
                 } else if (textStatus === 'abort') {
                    errorResponse='Ajax request aborted.';
                  } else {
                  errorResponse='Uncaught Error: ' + jqXHR.responseText;
                  }

	       $.alert({title: 'Error!',content:errorResponse});
	       CargarHistorialCheck();

	   }
	  });

 $("#gridview-checklist").table("refresh");

}//fin de funcion de carga de datos 

//      -------edicion de checklist -----------

function EditRow_check(id_re){


 $.alert({title: 'Error!',content:'No se puede editar el registro'});





for(var i=0;i< id_filas_edicion.length;i++){

if(id_filas_edicion[i]==id_re){


 $("#id_update_check").val(id_re);
 $("#unidad_edit").val(unidad_filas_edicion[i]).change();
 $("#updt_Observacion").val(observacion_filas_edicion[i]);
 
 //diseñamos la tabla edicion carhgando la configuracion establecida
 
 $("#tbody_items_updt").html("");
 
var catalogo_actualizar=catalogo_item_edicion[i];

//console.log('datos:'+catalogo_actualizar);

var iteracion=1;	

jQuery.each( catalogo_actualizar, function( i, val ) {
 //console.log( "#" + i +','+ val.nombre_opcion+':'+ val.valor_opcion);
 
if(iteracion % 2 == 0) {var color='#F4F4F8';}else {var color='#ede7f6'; }

  var textoHaciaTabla='<tr id="'+val.id_item+'" value='+val.id_item+' class="id_row_updt" style="background-color:'+color+'"><td>'+
  iteracion+'</td><td>'+val.nombre_opcion+'</td><td><strong>';
 

if(val.valor_opcion==1){

textoHaciaTabla=textoHaciaTabla+'<input type="checkbox" name="SI" class="Ucheck_'+val.id_item+'" value="1" style="margin-left:15px;" Checked>SI'+
'<input type="checkbox" name="NO" value="2" class="Ucheck_'+val.id_item+'" style="margin-left:15px;">NO</input>'+
'<input type="checkbox" name="N/A" value="3" class="Ucheck_'+val.id_item+'" style="margin-left:15px;">N/A</input>'+
'<input type="checkbox" name="Alerta" value="4"  class="Ucheck_'+val.id_item+'" style="margin-left:15px;">Alerta</input></strong></td><tr>';

}
if(val.valor_opcion==2){

textoHaciaTabla=textoHaciaTabla+'<input type="checkbox" name="SI" class="Ucheck_'+val.id_item+'" value="1" style="margin-left:15px;" >SI'+
'<input type="checkbox" name="NO" value="2" class="Ucheck_'+val.id_item+'" style="margin-left:15px;" Checked>NO</input>'+
'<input type="checkbox" name="N/A" value="3" class="Ucheck_'+val.id_item+'" style="margin-left:15px;">N/A</input>'+
'<input type="checkbox" name="Alerta" value="4"  class="Ucheck_'+val.id_item+'" style="margin-left:15px;">Alerta</input></strong></td><tr>';


}
if(val.valor_opcion==3){


textoHaciaTabla=textoHaciaTabla+'<input type="checkbox" name="SI" class="Ucheck_'+val.id_item+'" value="1" style="margin-left:15px;">SI'+
'<input type="checkbox" name="NO" value="2" class="Ucheck_'+val.id_item+'" style="margin-left:15px;">NO</input>'+
'<input type="checkbox" name="N/A" value="3" class="Ucheck_'+val.id_item+'" style="margin-left:15px;" Checked>N/A</input>'+
'<input type="checkbox" name="Alerta" value="4"  class="Ucheck_'+val.id_item+'" style="margin-left:15px;">Alerta</input></strong></td><tr>';

}
if(val.valor_opcion==4){

textoHaciaTabla=textoHaciaTabla+'<input type="checkbox" name="SI" class="Ucheck_'+val.id_item+'" value="1" style="margin-left:15px;">SI'+
'<input type="checkbox" name="NO" value="2" class="Ucheck_'+val.id_item+'" style="margin-left:15px;">NO</input>'+
'<input type="checkbox" name="N/A" value="3" class="Ucheck_'+val.id_item+'" style="margin-left:15px;">N/A</input>'+
'<input type="checkbox" name="Alerta" value="4"  class="Ucheck_'+val.id_item+'" style="margin-left:15px;" Checked>Alerta</input></strong></td><tr>';

}


$('#tbody_items_updt').append(textoHaciaTabla);
         iteracion++;
             
});//fin de foreach de item


$("#my-table-update").table("refresh");
 
 
}//fin si es el mismo registro
 
 
}//fin de for de edicion

$("#popupEditCheck").show();




//a la espera de cambios en los chekbox de update checklist
$("#my-table-update").on('change',"input[type='checkbox']",function(e){
   
	var title = $(this).attr('name');//atributo nombre del check
    var trid = $(this).parents('tr:first').attr('id'); // id de fila contenido
	
	var itemSeleccionado=$(this).val();
 
	//verifica que solo el que acabamos de poner quede activo
	$('input.Ucheck_'+trid+':checkbox:checked').each(function () {
	     var Valoriteracion = $(this).val();
		 
	     if(itemSeleccionado!=Valoriteracion){
		 $(this).prop( "checked", false );
		 } 
     }); 
});






}//fin de metodo editar fila

//      -------boton ninguna accion -----------

$('#btn_cancel_check').bind("tap", function() {
   $("#popupEditCheck").hide(); 
});

//      -------Guardamos actualizacion del checklist -----------

$('#btn_update_check').bind("tap", function() {

var arreglo_valor_actualizar=[];
arreglo_valor_actualizar.lenght=0;

var arreglo_id_actualizar=[];
arreglo_id_actualizar.lenght=0;

 
$('#my-table-update tr').each(function() {
 var item =this.id;
if(item!=''){
   arreglo_id_actualizar.push(item);

   $('input.Ucheck_'+item+':checkbox:checked').each(function () {
       var Valoriteracion = $(this).val();
		 
      if($(this).is(':checked')){
        arreglo_valor_actualizar.push(Valoriteracion);
      }
    });
}
	
});


var datosPostUpdate=[];
datosPostUpdate.lenght=0;

//console.log('cantidad valores:'+arreglo_valor_actualizar.length);
//console.log('items:'+arreglo_id_actualizar.length);

if(arreglo_valor_actualizar.length==arreglo_id_actualizar.length){

for(i=0; i<arreglo_id_actualizar.length;i++){
  var arreglo= {};
   arreglo['id_item']=arreglo_id_actualizar[i];
   arreglo['valor']=arreglo_valor_actualizar[i];
  datosPostUpdate.push(arreglo);
}
	
var	aInfoUpdate = JSON.stringify(datosPostUpdate);
 
 unidad_enviar=$("#unidad_edit").val();
 observacion_enviar=$("#updt_Observacion").val();
 var id_re_updt_now= $("#id_update_check").val();
 
            $.ajax({
                 type: "POST",
                 url: "http://191.98.228.86/GestionFlota_ApiRest/UpdateChecklist",
                 data:{
				 'array':aInfoUpdate, 
				 'usuario':id_usuario,
				 'nombreusuario':logeado,
				 'unidad':unidad_enviar,
				 'empresa':empresa_activa,
				 'id_resumen':id_re_updt_now,
				 'observacion':observacion_enviar,
                 'id_session':id_session
				 },
                  beforeSend: function() {
                          $.mobile.loading('show');
						  $("#updt_Observacion").prop('disabled', true);
                      },
                      success: function (data) {
                           $.mobile.loading('hide');
                           $.alert({title: 'alerta!',content: data});
						   // console.log(data);
							
							 $("#updt_Observacion").prop('disabled', false);
							  CargarHistorialCheck();
							  $.mobile.changePage("#historialCheck");
                       },
                          error: function (jqXHR, textStatus, errorThrown) {
                             var errorResponse='';
	                          if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                             } else if (jqXHR.status == 404) {
                              errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                    $.alert({title: 'Error!',content:errorResponse});

                   }
                });

}else{
$.alert({title: 'mensaje:',content: 'Debes completar el checklist'});
}

});//fin de actualizar el checklist

//      -------cancelacion de registro de checklist -----------

function DeletedRow_Check(id){



$.confirm({
    title: 'Importante!',
    content: '¿deseas borrar registro checklist?',
    buttons: {
        confirm: function () {
       
            $.ajax({
                 type: "POST",
                 url: "http://191.98.228.86/GestionFlota_ApiRest/BorrarChecklist",
                 data: { 
				 'usuario':id_usuario,
				 'nombreusuario':logeado,
				 'empresa':empresa_activa,
				 'id_resumen':id,
                  'id_session':id_session
                 },
                  beforeSend: function() {
                     $.mobile.loading('show');
                     },
                    success: function (data) {
                          
                      $.mobile.loading('hide');
                      $.alert({title: 'Alerta!',content: data});
                             CargarHistorialCheck();
							  $.mobile.changePage("#historialCheck");
                       },
                          error: function (jqXHR, textStatus, errorThrown) {
                           if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse}); 

                   }
                });
        },
        cancel: function () {
            $.alert('Sin accion!');
        }
    }
});


}//fin de metodo borrar checklist


/*  -----------------__________________------------------------ */

/*  ----------------pagina de accidentes----------------------- */

/*  -----------------__________________------------------------ */



$('#link_agregarAccidente').bind("tap", function() {
if((id_usuario=='')||(empresa_activa=='')){
//console.log('datos vacios');
      $.mobile.changePage("#inicio");
 }else{ 
      if(ArrayPais.length==0){
	       CargarLocalidades();
		   CargarSelectvehiculos();
          
	  }
	  
	 
        $.mobile.changePage("#pg_insertAccidente");
	}
});

$('#atras_pg_nuevoAccidente').bind("tap", function() {
    $.mobile.changePage("#home");
    
});


/*  -----2.datos default Accidentes ------ */


function CargarLocalidades(){

$('#pais_acc').val('');
$('#pais_acc').html('');

$('#dept_acc').val('');
$('#dept_acc').html('');

$('#pais_acc_edit').html('');
$('#dept_acc_edit').html('');


ArrayPais.length=0;
ArrayIdPais.length=0;

ArrayIdDept.length=0;
ArrayNombreDept.length=0;
ArrayPaisDept.length=0;

 $.ajax({
           type: "POST",
           url: "http://191.98.228.86/GestionFlota_ApiRest/listarLocalidades",
           data:{},
           beforeSend: function() {
                 $.mobile.loading('show');
          },success: function (data) {
                  $.mobile.loading('hide');
                          
           $.each(data, function (index){
		   
		   if (!data[0]){$.alert({title: 'Error:',content: 'Sin Registros de localidades'});};
					  
				var PaisEncontrado=false;
				var id_dept=data[index].id_dept; 
                var nombre_dept=data[index].nombre_dept;	
                var nombre_pais=data[index].nombre_pais;	
                var id_pais=data[index].id_pais;

                for(var x=0; x < ArrayIdPais.length; x++){
					  if(id_pais==ArrayIdPais[x]){
					   PaisEncontrado=true;
					  }
				 }
					   
				 if(PaisEncontrado==false){
					 ArrayIdPais.push(id_pais);
					 ArrayPais.push(nombre_pais);
					 $('#pais_acc').append('<option value="'+id_pais+'">'+nombre_pais+'</option>');
					 $('#pais_acc_edit').append('<option value="'+id_pais+'">'+nombre_pais+'</option>');
					// console.log('cargamos en pais edidicion:<option value="'+id_pais+'">'+nombre_pais+'</option>')
					    
				 }
					     
						//cargamos los departamentos
						ArrayIdDept.push(id_dept);
                        ArrayNombreDept.push(nombre_dept);
						ArrayPaisDept.push(id_pais);
                           
			}); //fin de foreach
					 
					 	
              var miopcion=$('#pais_acc').val();
		      $('#dept_acc').html('');
				
			 for(var i=0; i < ArrayIdDept.length; i++){
                if(miopcion==ArrayPaisDept[i]){
                  $('#dept_acc').append('<option value="'+ArrayIdDept[i]+'">'+ArrayNombreDept[i]+'</option>');
	              $('#dept_acc_edit').append('<option value="'+ArrayIdDept[i]+'">'+ArrayNombreDept[i]+'</option>');
	             
				 }
              }	
		
	        
			 
			
	
          },error: function (jqXHR, textStatus, errorThrown) {
		 
                           var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse});
                   
		                 CargarLocalidades();
				   }
                });



}//fin de funcion de llenar localidades

$('#pais_acc').change(function(){

 var miopcion=$(this).find("option:selected").attr('value');

  $('#dept_acc').html('');
  
   for(var i=0; i < ArrayIdDept.length; i++){
       if(miopcion==ArrayPaisDept[i]){
         $('#dept_acc').append('<option value="'+ArrayIdDept[i]+'">'+ArrayNombreDept[i]+'</option>');
	    }
    }	
		
  $('#dept_acc').selectmenu('refresh', true);	
		
});


/*   ----- detalles de marcas-descripcion de vehiculos----- */   
function CargarSelectvehiculos(){


  $("#Brand").val('');
  $("#model").val('');
  $("#plate").val('');
  $("#year").val('');
  $("#tipo_veh_acc").val('');


var iteracion=0;

$('#select_unidad_Acc').html('');



for(b=0; b < ArrayFlota.length; b++){
			 
  if(iteracion==0){
  
  $("#Brand").val(ArrayFlota[b]['marca']);
  $("#model").val(ArrayFlota[b]['modelo']);
  $("#plate").val(ArrayFlota[b]['placa_ve']);
  $("#year").val(ArrayFlota[b]['anio']);
  $("#tipo_veh_acc").val(ArrayFlota[b]['descripcion']);
  }

  $('#select_unidad_Acc').append('<option value="'+ArrayFlota[b]['id_ve']+'">'+ArrayFlota[b]['nombre_ve']+'</option>');			   
iteracion++;
}//fin de for de flota

   
}//fin de cargar detalle unidades



$('#select_unidad_Acc').change(function(){

  var iteracion=0;
  var miopcion=$(this).find("option:selected").attr('value');
  
  $("#Brand").val('');
  $("#model").val('');
  $("#plate").val('');
  $("#year").val('');
  $("#tipo_veh_acc").val('');
  

for(b=0; b < ArrayFlota.length; b++){
			 
  if(ArrayFlota[b]['id_ve']==miopcion){
  
  $("#Brand").val(ArrayFlota[b]['marca']);
  $("#model").val(ArrayFlota[b]['modelo']);
  $("#plate").val(ArrayFlota[b]['placa_ve']);
  $("#year").val(ArrayFlota[b]['anio']);
  $("#tipo_veh_acc").val(ArrayFlota[b]['descripcion']);
  }

}//fin de for de flota


  
});



//----------actuador de tipo accidente
var clasificacion_accidente=0;
//--------zona de accidente dentro del vehiculo------------
var zona_accidente='0';
//---------------------Estado_carretera---------
var estado_carretera=0;


/*   ----- Guardamos fotos de Accidente----- */ 

ArregloInsertFotos.length=0;
var SubidosFilesAcc=[];
SubidosFilesAcc.length=0;
  
$("#but_upload").click(function(){

var count = $('.container .content').length;
       count = Number(count);


if(count < 10){


  var fd = new FormData();
  var files = $('#file')[0].files[0];
  fd.append('file',files);
  fd.append('request',1);
  fd.append('empresa',empresa_activa);

 var EncontradoFileAcc=false;
  //console.log($('#file').val());

for(var z=0; z < SubidosFilesAcc.length; z++){
  if(SubidosFilesAcc[z]==$('#file').val()){
  
  EncontradoFileAcc=true;
   $.alert({title: 'Informacion:',content: 'imagen repetida'});
  }
  
  }


if(EncontradoFileAcc==false){
  SubidosFilesAcc.push($('#file_en').val());




  // AJAX request
  $.ajax({
   url: 'http://191.98.228.86/GestionFlotaFiles/HandleFotosAccidentes.php',
   type: 'post',
   data: fd,
   contentType: false,
   processData: false,
   beforeSend: function(){
    $.mobile.loading('show');
     $("#but_upload").prop('disabled', true);
  },success: function(response){
      
     $("#but_upload").prop('disabled', false);
     if(response != 0){
       var count = $('.container .content').length;
       count = Number(count) + 1;
       // Show image preview with Delete button
       $('.container').append("<div class='content' id='content_"+count+"' ><img src='"+response+"'  class='itemsFotoAcc' width='100' height='100'><Button class='delete' id='delete_"+count+"'>Delete</button></div>");
        ArregloInsertFotos.push(response);
        $.mobile.loading('hide');
        $('#file').val('');
	 }else{
         $.mobile.loading('hide');
	     $.alert({title: 'Error!',content: 'file not uploadeds'}); 
     }
   },error: function (jqXHR, textStatus, errorThrown) {
                          var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse});
          }
  });

}

}else{
    $.alert({title: 'Informacion:',content: 'solo se permiten 10 imagenes'});
   }

 });


/*  ---- visor de fotos de acccidente  -----   */
$('.container').on('click','.content .itemsFotoAcc',function(){
 $("#viewPicturesAcc").popup("open"); 
 
     var foto_a_ver=$(this).attr("src");

	 
     $("#imagen_popupAcc").attr("src",foto_a_ver);
});






/*   ----- Borrar fotos de Accidente----- */
 
$('.container').on('click','.content .delete',function(){

  var id = this.id;
  var split_id = id.split('_');
  var num = split_id[1];

  // Get image source
  var imgElement_src = $( '#content_'+num+' img' ).attr("src");
  
 // console.log('src:'+imgElement_src);
  
  
  
              $('#content_'+num).remove(); 
			   for(var i=0; i < ArregloInsertFotos.length;i++){
			    if(ArregloInsertFotos[i]==imgElement_src){
				    ArregloInsertFotos[i]='';
				}
			   } 
           
		   
		  
 
}); 

/*   -----Manejo de Firma de Conductor de Accidente----- */

var signaturePad = new SignaturePad(document.getElementById('signature-pad'));

function resizeCanvas() {
    var ratio =  Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
    signaturePad.clear(); // otherwise isEmpty() might return incorrect value
}

//window.addEventListener("resize", resizeCanvas);
//resizeCanvas();

$('#clear').bind("click", function() {

  signaturePad.on();
  signaturePad.clear();
  dataURL_img='';
 
$('#saved_signed').prop("checked", false).checkboxradio("refresh");
  //console.log('clic en limpiar')
});

$('#saved_signed').change(function() {

if(this.checked){
   if(signaturePad.isEmpty()){
       $.alert({title: 'alerta!',content: 'debes ingresar una firma'});
	   $('#saved_signed').prop('checked', false);
    }else{
	dataURL_img = signaturePad.toDataURL();
    dataURL_img=dataURL_img.replace(/^data:image\/(png|jpg);base64,/, "");
    //console.log(dataURL_img);
    signaturePad.off();  
   }
 }else{
   signaturePad.on();
 }
});


/*   ----- Guardamos Nuevo registro de Accidente----- */ 

$('#BtnGuardarAcc').bind("tap", function() {



var banderaInsertar=true;

if(($("#pais_acc").val()=='')||($("#pais_acc").val()==0)){
 $("#Datos_generales_acc").collapsible('expand');
 banderaInsertar=false;
}


clasificacion_accidente=$("#tipo_Acc_class").val();
zona_accidente=$("#zona_Acc_class").val();
estado_carretera=$("#tipo_Carr_class").val();

if((clasificacion_accidente==0)||(zona_accidente==0)){
banderaInsertar=false;
$("#Tipo_accidente").collapsible('expand');
}

if((estado_carretera==0)||($("#clima_acc").val()=='')||($("#explicacion_acc").val()=='')){
  banderaInsertar=false;
  $("#Estado_Carretera").collapsible('expand');
}

if(($("#conductor_acc").val()=='')||($("#licencia_acc").val()=='')
||($("#tipo_lic_acc").val()=='')||($("#expiracion_lic").val()=='')
||($("#direc_cond_acc").val()=='')||($("#telf_cond_acc").val()=='')
||($("#edad_cond_acc").val()=='')){
banderaInsertar=false;
 $("#Datos_conductor").collapsible('expand');
}

if(($("#fecha_acc").val()=='')||($("#hora_acc").val()=='')||
($("#boleta_poli_acc").val()=='')||($("#boleta_aseg_acc").val()=='')){
banderaInsertar=false;
 $("#fecha_accidente").collapsible('expand');
}

if(($("#provincia_acc").val()=='')||
($("#canton_acc").val()=='')||
($("#calle_acc").val()=='')||
($("#avenida_acc").val()=='')||
($("#lugar_acc").val()=='')){
banderaInsertar=false;
$("#lugar_accidente").collapsible('expand');
}


if($("#relato_acc").val()==''){
banderaInsertar=false;
$("#Relato").collapsible('expand');
}

if(banderaInsertar==false){
$.alert({title: 'alerta!',content: 'algunos campos aun no han sido llenados'});
}


var ImagenesValidas=false;
for(var i=0; i < ArregloInsertFotos.length;i++){
	if(ArregloInsertFotos[i]!=''){
			ImagenesValidas=true;	    
	}
}

if(ImagenesValidas==false){
banderaInsertar=false
$("#Fotos").collapsible('expand');
$.alert({title: 'alerta!',content: 'debes seleccionar y cargar una foto almenos'});
}

if(dataURL_img==''){
banderaInsertar=false
$.alert({title: 'alerta!',content: 'debes ingresar y aceptar una firma'});
$("#FirmaConductor").collapsible('expand');
}

var datosPostAccidente=[];
var arregloAccidente={};

arregloAccidente['conductor_acc']=$('#conductor_acc').val();arregloAccidente['licencia_acc']=$('#licencia_acc').val();
arregloAccidente['tipo_lic_acc']=$('#tipo_lic_acc').val();arregloAccidente['expiracion_lic']=$('#expiracion_lic').val();
arregloAccidente['direc_cond_acc']=$('#direc_cond_acc').val();arregloAccidente['telf_cond_acc']=$('#telf_cond_acc').val();
arregloAccidente['edad_cond_acc']=$('#edad_cond_acc').val();

arregloAccidente['fecha_acc']=$('#fecha_acc').val();arregloAccidente['hora_acc']=$('#hora_acc').val();
arregloAccidente['boleta_poli_acc']=$('#boleta_poli_acc').val();arregloAccidente['boleta_aseg_acc']=$('#boleta_aseg_acc').val();
arregloAccidente['provincia_acc']=$('#provincia_acc').val();arregloAccidente['canton_acc']=$('#canton_acc').val();
arregloAccidente['calle_acc']=$('#calle_acc').val();arregloAccidente['avenida_acc']=$('#avenida_acc').val();
arregloAccidente['lugar_acc']=$('#lugar_acc').val();

arregloAccidente['clasificacion_acc']=clasificacion_accidente;
arregloAccidente['tipo_accidente']=zona_accidente;
arregloAccidente['estado_carretera']=estado_carretera;
arregloAccidente['clima_acc']=$('#clima_acc').val();
arregloAccidente['explicacion_acc']=$('#explicacion_acc').val();

arregloAccidente['marca_otro1']=$('#marca_otro1').val();arregloAccidente['tipo_otro1']=$('#tipo_otro1').val();
arregloAccidente['placa_otro1']=$('#placa_otro1').val();arregloAccidente['danio_otro1']=$('#danio_otro1').val();
arregloAccidente['propietario_otro1']=$('#propietario_otro1').val();
arregloAccidente['direccion_otro1']=$('#direccion_otro1').val();arregloAccidente['telefono_otro1']=$('#telefono_otro1').val();

arregloAccidente['marca_otro2']=$('#marca_otro2').val();arregloAccidente['tipo_otro2']=$('#tipo_otro2').val();
arregloAccidente['placa_otro2']=$('#placa_otro2').val();arregloAccidente['danio_otro2']=$('#danio_otro2').val();
arregloAccidente['propietario_otro2']=$('#propietario_otro2').val();arregloAccidente['direccion_otro2']=$('#direccion_otro2').val();
arregloAccidente['telefono_otro2']=$('#telefono_otro2').val();

arregloAccidente['marca_otro3']=$('#marca_otro3').val();arregloAccidente['tipo_otro3']=$('#tipo_otro3').val();arregloAccidente['placa_otro3']=$('#placa_otro3').val();
arregloAccidente['danio_otro3']=$('#danio_otro3').val();arregloAccidente['propietario_otro3']=$('#propietario_otro3').val();arregloAccidente['direccion_otro3']=$('#direccion_otro3').val();
arregloAccidente['telefono_otro3']=$('#telefono_otro3').val();

arregloAccidente['marca_otro4']=$('#marca_otro4').val();arregloAccidente['tipo_otro4']=$('#tipo_otro4').val();arregloAccidente['placa_otro4']=$('#placa_otro4').val();arregloAccidente['danio_otro4']=$('#danio_otro4').val();
arregloAccidente['propietario_otro4']=$('#propietario_otro4').val();arregloAccidente['direccion_otro4']=$('#direccion_otro4').val();arregloAccidente['telefono_otro4']=$('#telefono_otro4').val();

arregloAccidente['nombre_pas']=$('#nombre_pas').val();
arregloAccidente['identificacion_pas']=$('#identificacion_pas').val();arregloAccidente['direccion_pas']=$('#direccion_pas').val();
arregloAccidente['telefono_pass']=$('#telefono_pass').val();arregloAccidente['vehiculo_pass']=$('#vehiculo_pass').val();

arregloAccidente['nombre_pas1']=$('#nombre_pas1').val();arregloAccidente['identificacion_pas1']=$('#identificacion_pas1').val();arregloAccidente['direccion_pas1']=$('#direccion_pas1').val();arregloAccidente['telefono_pas1']=$('#telefono_pas1').val();
arregloAccidente['vehiculo_pass1']=$('#vehiculo_pass1').val();

arregloAccidente['nombre_pas2']=$('#nombre_pas2').val();arregloAccidente['identificacion_pas2']=$('#identificacion_pas2').val();
arregloAccidente['direccion_pas2']=$('#direccion_pas2').val();arregloAccidente['telefono_pas2']=$('#telefono_pas2').val();arregloAccidente['vehiculo_pass2']=$('#vehiculo_pass2').val();

arregloAccidente['nombre_testigo']=$('#nombre_testigo').val();
arregloAccidente['identificacion_testigo']=$('#identificacion_testigo').val();arregloAccidente['direccion_testigo']=$('#direccion_testigo').val();arregloAccidente['telefono_testigo']=$('#telefono_testigo').val();
arregloAccidente['nombre_testigo1']=$('#nombre_testigo1').val();
arregloAccidente['identificacion_testigo1']=$('#identificacion_testigo1').val();

arregloAccidente['direccion_testigo1']=$('#direccion_testigo1').val();
arregloAccidente['telefono_testigo1']=$('#telefono_testigo1').val();
arregloAccidente['nombre_lesionados']=$('#nombre_lesionados').val();
arregloAccidente['identificacion_lesionados']=$('#identificacion_lesionados').val();arregloAccidente['direccion_lesionados']=$('#direccion_lesionados').val();
arregloAccidente['tipo_lesion']=$('#tipo_lesion').val();arregloAccidente['nombre_lesionados1']=$('#nombre_lesionados1').val();
arregloAccidente['identificacion_lesionados1']=$('#identificacion_lesionados1').val();arregloAccidente['direccion_lesionados1']=$('#direccion_lesionados1').val();
arregloAccidente['tipo_lesion1']=$('#tipo_lesion1').val();

arregloAccidente['nombre_lesionados2']=$('#nombre_lesionados2').val();arregloAccidente['identificacion_lesionados2']=$('#identificacion_lesionados2').val();
arregloAccidente['direccion_lesionados2']=$('#direccion_lesionados2').val();arregloAccidente['tipo_lesion2']=$('#tipo_lesion2').val();

arregloAccidente['nombre_lesionados3']=$('#nombre_lesionados3').val();arregloAccidente['identificacion_lesionados3']=$('#identificacion_lesionados3').val();
arregloAccidente['direccion_lesionados3']=$('#direccion_lesionados3').val();arregloAccidente['tipo_lesion3']=$('#tipo_lesion3').val();

arregloAccidente['nombre_lesionados4']=$('#nombre_lesionados4').val();arregloAccidente['identificacion_lesionados4']=$('#identificacion_lesionados4').val();
arregloAccidente['direccion_lesionados4']=$('#direccion_lesionados4').val();arregloAccidente['tipo_lesion4']=$('#tipo_lesion4').val();
arregloAccidente['nombre_lesionados5']=$('#nombre_lesionados5').val();arregloAccidente['identificacion_lesionados5']=$('#identificacion_lesionados5').val();
arregloAccidente['direccion_lesionados5']=$('#direccion_lesionados5').val();arregloAccidente['tipo_lesion5']=$('#tipo_lesion5').val();

arregloAccidente['nombre_peaton']=$('#nombre_peaton').val();arregloAccidente['identificacion_peaton']=$('#identificacion_peaton').val();
arregloAccidente['direccion_peaton']=$('#direccion_peaton').val();arregloAccidente['tipo_lesion_peaton']=$('#tipo_lesion_peaton').val();
arregloAccidente['relato_acc']=$('#relato_acc').val();

datosPostAccidente.push(arregloAccidente);
var	aInfoAccidente = JSON.stringify(arregloAccidente);
//console.log(aInfoAccidente);

if(banderaInsertar==true){

$("#BtnGuardarAcc").attr('disabled', true);
$('#saved_signed').prop("checked", false).checkboxradio("refresh");

 
var file_fotos=ArregloInsertFotos.join(",");
var unidad_accidente_enviar=$('#select_unidad_Acc').val();

var departamento_acc_enviar=$('#dept_acc').val();
var fecha_accidente_enviar=$('#fecha_acc').val();
var pais_accidente_enviar=$('#pais_acc').val();

 $.ajax({
        url: 'http://191.98.228.86/GestionFlota_ApiRest/InsertarAccidente',
        type: 'post',
        data: {
		'array_datos':aInfoAccidente, 
        'usuario':id_usuario,
        'empresa':empresa_activa,
        'nombreusuario':logeado,
        'vehiculo':unidad_accidente_enviar,
        'dept_id':departamento_acc_enviar,
        'fecha_accidente':fecha_accidente_enviar,
        'pais':pais_accidente_enviar,
        'img_data':dataURL_img,
        'file_fotos':file_fotos,
        'id_session':id_session
		},
        success: function(response){
		
		 $("#BtnGuardarAcc").attr('disabled', false);
			
			
			//vaciar campos si es correcto el ingreso
			if(response[0]=='Detalle Accidente registrado'){
			$.alert({title: 'Exitoso:',content:response});
			  //vaciamos firma
			  signaturePad.clear();
			  signaturePad.on();
			  $('#saved_signed').prop('checked', false);
			  dataURL_img='';
			 
			  //vaciamos fotos
			  ArregloInsertFotos.length=0;
			 $(".container").html("");
			  vaciarDatosAccidente();
			}else{
			$.alert({title: 'alerta!',content:response});
			}
			
			
        },error:  function (jqXHR, textStatus, errorThrown){
	                         var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }
	                     $.alert({title: 'Error!',content:errorResponse});
                   }
      });


}

});//fin de boton guardar


//-----funcion para limpiar campos luego de guardado------
function vaciarDatosAccidente(){

$('#conductor_acc').val('');$('#licencia_acc').val('');
$('#tipo_lic_acc').val('');$('#expiracion_lic').val('');
$('#direc_cond_acc').val('');$('#telf_cond_acc').val('');
$('#edad_cond_acc').val('');

$('#fecha_acc').val('');$('#hora_acc').val('');
$('#boleta_poli_acc').val('');$('#boleta_aseg_acc').val('');
$('#provincia_acc').val('');$('#canton_acc').val('');
$('#calle_acc').val('');$('#avenida_acc').val('');
$('#lugar_acc').val('');

$('#clima_acc').val('');
$('#explicacion_acc').val('');

$('#marca_otro1').val('');$('#tipo_otro1').val('');
$('#placa_otro1').val('');$('#danio_otro1').val('');
$('#propietario_otro1').val('');
$('#direccion_otro1').val('');$('#telefono_otro1').val('');

$('#marca_otro2').val('');$('#tipo_otro2').val('');
$('#placa_otro2').val('');$('#danio_otro2').val('');
$('#propietario_otro2').val('');$('#direccion_otro2').val('');
$('#telefono_otro2').val('');

$('#marca_otro3').val('');$('#tipo_otro3').val('');$('#placa_otro3').val('');
$('#danio_otro3').val('');$('#propietario_otro3').val('');$('#direccion_otro3').val('');
$('#telefono_otro3').val('');

$('#marca_otro4').val('');$('#tipo_otro4').val('');
$('#placa_otro4').val('');$('#danio_otro4').val('');
$('#propietario_otro4').val('');$('#direccion_otro4').val('');$('#telefono_otro4').val('');

$('#nombre_pas').val('');
$('#identificacion_pas').val('');$('#direccion_pas').val('');
$('#telefono_pass').val('');$('#vehiculo_pass').val('');

$('#nombre_pas1').val('');$('#identificacion_pas1').val('');$('#direccion_pas1').val('');
$('#telefono_pas1').val('');
$('#vehiculo_pass1').val('');

$('#nombre_pas2').val('');$('#identificacion_pas2').val('');
$('#direccion_pas2').val('');$('#telefono_pas2').val('');$('#vehiculo_pass2').val('');

$('#nombre_testigo').val('');
$('#identificacion_testigo').val('');$('#direccion_testigo').val('');
$('#telefono_testigo').val('');
$('#nombre_testigo1').val('');
$('#identificacion_testigo1').val('');

$('#direccion_testigo1').val();
$('#telefono_testigo1').val();
$('#nombre_lesionados').val();
$('#identificacion_lesionados').val('');$('#direccion_lesionados').val('');
$('#tipo_lesion').val('');$('#nombre_lesionados1').val('');
$('#identificacion_lesionados1').val('');$('#direccion_lesionados1').val('');
$('#tipo_lesion1').val('');

$('#nombre_lesionados2').val('');$('#identificacion_lesionados2').val('');
$('#direccion_lesionados2').val('');$('#tipo_lesion2').val('');

$('#nombre_lesionados3').val('');$('#identificacion_lesionados3').val('');
$('#direccion_lesionados3').val('');$('#tipo_lesion3').val('');

$('#nombre_lesionados4').val('');$('#identificacion_lesionados4').val('');
$('#direccion_lesionados4').val('');$('#tipo_lesion4').val('');
$('#nombre_lesionados5').val('');$('#identificacion_lesionados5').val('');
$('#direccion_lesionados5').val('');$('#tipo_lesion5').val('');

$('#nombre_peaton').val('');$('#identificacion_peaton').val('');
$('#direccion_peaton').val('');$('#tipo_lesion_peaton').val('');
$('#relato_acc').val('');





}



/*  -----------------__________________------------------------ */

/*  ----------------pagina de  Historial accidentes----------------------- */

/*  -----------------__________________------------------------ */





$('#link_historicoAccidente').bind("tap", function() {
if((id_usuario=='')||(empresa_activa=='')){
      $.mobile.changePage("#inicio");
 }else{
        
		if(ArrayPais.length==0){ CargarLocalidades();};
		if(ArrayFlota.length==0){ CargarVehiculos();};
		
        CargarHistorialAccidentes();
        $.mobile.changePage("#pg_historialAccidente");
      
	}
});

$('#atras_hi_accidente').bind("tap", function() {
    $.mobile.changePage("#home");
  
});


var row_edit_accidente=[];
row_edit_accidente.length=0;


function CargarHistorialAccidentes(){


//llenamos el detalle de vehiculos en edicion
$('#select_unidad_Acc_edit').html('');
for(b=0; b < ArrayFlota.length; b++){		 
$('#select_unidad_Acc_edit').append('<option value="'+ArrayFlota[b]['id_ve']+'">'+ArrayFlota[b]['nombre_ve']+'</option>');			   
}


$("#popupAccidente").hide();

row_edit_accidente.length=0;
$('#tb_historicoAccidente').html('');
var iteracion_acc_hi=1;

$.ajax({
           url: 'http://191.98.228.86/GestionFlota_ApiRest/HistorialAccidentes',
           type: 'post',
           data: {'id_usuario':id_usuario,'id_empresa':empresa_activa},
           success: function(data){
			if (!data[0]){$.alert({title: 'Alerta:',content: 'Sin Registros de Accidentes'});};
			$.each(data, function (index){
			if(data[index].bandera_edicion==1){

               //<a href="#popupAccidente"  onClick="EditarAcidente('+data[index].id+')"  data-rel="popup"'+
              // 'data-position-to="window" data.transition="pop">Editar</a>
			
			 $('#tb_historicoAccidente').append('<tr style="border-bottom: 1px solid #d6d6d6;"><td>'+
                iteracion_acc_hi+'</td><td>'+data[index].nombre_ve+'-'+data[index].placa_ve+'</td>'+
                '<td><label>'+data[index].insertado+'</label></td><td>--</td><td><a href="" onClick="cancelarAccidente('+data[index].id+')">Cancelar</a></td></tr>');
			
			}else{
			
			 $('#tb_historicoAccidente').append('<tr style="border-bottom: 1px solid #d6d6d6;"><td>'+
                iteracion_acc_hi+'</td><td>'+data[index].nombre_ve+'-'+data[index].placa_ve+'</td>'+
              '<td><label>'+data[index].insertado+'</label></td><td><label>-</label></td><td><label>-</label></td></tr>');
			
			}
			
			
			   var arreglo_item={
			   "id":data[index].id,"id_unidad":data[index].id_unidad,
			   "nombre_ve":data[index].nombre_ve,"placa_ve":data[index].placa_ve,
			   "pais_id":data[index].pais_id,"dept_id":data[index].dept_id,
			   "conductor_acc":data[index].conductor_acc,"licencia_acc":data[index].licencia_acc,
			   "tipo_lic_acc":data[index].tipo_lic_acc,"expiracion_lic":data[index].expiracion_lic,
			   "direc_cond_acc":data[index].direc_cond_acc,"telf_cond_acc":data[index].telf_cond_acc,
			   "edad_cond_acc":data[index].edad_cond_acc,"fecha_acc":data[index].fecha_acc,
			   "hora_acc":data[index].hora_acc,"boleta_poli_acc":data[index].boleta_poli_acc,
			   "boleta_aseg_acc":data[index].boleta_aseg_acc,"provincia_acc":data[index].provincia_acc,
			   "canton_acc":data[index].canton_acc,"calle_acc":data[index].calle_acc,
			   "avenida_acc":data[index].avenida_acc,"lugar_acc":data[index].lugar_acc,
			   "clasificacion_acc":data[index].clasificacion_acc,
			   "tipo_accidente":data[index].tipo_accidente,"estado_carretera":data[index].estado_carretera,
			   "clima_acc":data[index].clima_acc,"explicacion_acc":data[index].explicacion_acc,
			   "marca_otro1":data[index].marca_otro1,"tipo_otro1":data[index].tipo_otro1,
			   "placa_otro1":data[index].placa_otro1,"danio_otro1":data[index].danio_otro1,
			   "propietario_otro1":data[index].propietario_otro1,
			   "direccion_otro1":data[index].direccion_otro1,
			   "telefono_otro1":data[index].telefono_otro1,
			   "marca_otro2":data[index].marca_otro2,
			   "tipo_otro2":data[index].tipo_otro2,"placa_otro2":data[index].placa_otro2,
			   "danio_otro2":data[index].danio_otro2,
			   "propietario_otro2":data[index].propietario_otro2,
			   "direccion_otro2":data[index].direccion_otro2,
			   "telefono_otro2":data[index].telefono_otro2,
			   "marca_otro3":data[index].marca_otro3,
			   "tipo_otro3":data[index].tipo_otro3,
			   "placa_otro3":data[index].placa_otro3,
			   "danio_otro3":data[index].danio_otro3,
			   "propietario_otro3":data[index].propietario_otro3,
			   "direccion_otro3":data[index].direccion_otro3,
			   "telefono_otro3":data[index].telefono_otro3,
			   "marca_otro4":data[index].marca_otro4,"tipo_otro4":data[index].tipo_otro4,
			   "placa_otro4":data[index].placa_otro4,
			   "danio_otro4":data[index].danio_otro4,"propietario_otro4":data[index].propietario_otro4,
			   "direccion_otro4":data[index].direccion_otro4,
			   "telefono_otro4":data[index].telefono_otro4,"nombre_pas":data[index].nombre_pas,
			   "identificacion_pas":data[index].identificacion_pas,
			   "direccion_pas":data[index].direccion_pas,"telefono_pass":data[index].telefono_pass,
			   "vehiculo_pass":data[index].vehiculo_pass,
			   "nombre_pas1":data[index].nombre_pas1,"identificacion_pas1":data[index].identificacion_pas1,
			   "direccion_pas1":data[index].direccion_pas1,
			   "telefono_pas1":data[index].telefono_pas1,"vehiculo_pass1":data[index].vehiculo_pass1,
			   "nombre_pas2":data[index].nombre_pas2,
			   "identificacion_pas2":data[index].identificacion_pas2,"direccion_pas2":data[index].direccion_pas2,
			   "telefono_pas2":data[index].telefono_pas2,
			   "vehiculo_pass2":data[index].vehiculo_pass2,"nombre_testigo":data[index].nombre_testigo,
			   "identificacion_testigo":data[index].identificacion_testigo,
			   "direccion_testigo":data[index].direccion_testigo,"telefono_testigo":data[index].telefono_testigo,
			   "nombre_testigo1":data[index].nombre_testigo1, "identificacion_testigo1":data[index].identificacion_testigo1,
			   "direccion_testigo1":data[index].direccion_testigo1,"telefono_testigo1":data[index].telefono_testigo1,
			   "nombre_lesionados":data[index].nombre_lesionados,
			   "identificacion_lesionados":data[index].identificacion_lesionados,"direccion_lesionados":data[index].direccion_lesionados,
			   "tipo_lesion":data[index].tipo_lesion, "nombre_lesionados1":data[index].nombre_lesionados1,
			   "identificacion_lesionados1":data[index].identificacion_lesionados1,"direccion_lesionados1":data[index].direccion_lesionados1,
			   "tipo_lesion1":data[index].tipo_lesion1,
			   "nombre_lesionados2":data[index].nombre_lesionados2,"identificacion_lesionados2":data[index].identificacion_lesionados2,
			   "direccion_lesionados2":data[index].direccion_lesionados2,
			   "tipo_lesion2":data[index].tipo_lesion2,
			   "nombre_lesionados3":data[index].nombre_lesionados3,"identificacion_lesionados3":data[index].identificacion_lesionados3,
			   "direccion_lesionados3":data[index].direccion_lesionados3,
			   "tipo_lesion3":data[index].tipo_lesion3,"nombre_lesionados4":data[index].nombre_lesionados4,"identificacion_lesionados4":data[index].identificacion_lesionados4,
			    "direccion_lesionados4":data[index].direccion_lesionados4,"tipo_lesion4":data[index].tipo_lesion4,"nombre_lesionados5":data[index].nombre_lesionados5,
			   "identificacion_lesionados5":data[index].identificacion_lesionados5,"direccion_lesionados5":data[index].direccion_lesionados5,"tipo_lesion5":data[index].tipo_lesion5, "nombre_peaton":data[index].nombre_peaton,
			   "identificacion_peaton":data[index].identificacion_peaton,"direccion_peaton":data[index].direccion_peaton,"tipo_lesion_peaton":data[index].tipo_lesion_peaton,
			   "relato_acc":data[index].relato_acc,"file_fotos":data[index].file_fotos,
			   "file_firma":data[index].file_firma,
			    "ruta_stored_fotos":data[index].ruta_stored_fotos,
			   "bandera_edicion":data[index].bandera_edicion,"insertado":data[index].insertado
			   };
			
			   row_edit_accidente.push(arreglo_item);
			
			
			iteracion_acc_hi++;
			
			});
			
           } 
         });

}//fin de cargas historial de accidentes



/*   ----- Edicion de  Accidente----- */ 


var clasificacion_accidente_edit=0;
var zona_accidente_edit=0;
var estado_carretera_edit=0;

var ArregloUpdateFotosAccidente=[];

function EditarAcidente(id){


$("#id_update_accidente").val(id);

ArregloUpdateFotosAccidente.length=0;
$('.container_editAcc').html('');

//console.log('debemos editar');
for(var i=0; i < row_edit_accidente.length; i++){

if(row_edit_accidente[i]['id']==id){
//seteamos valores de select
$("#pais_acc_edit").val(row_edit_accidente[i]['pais_id']).change();
$("#dept_acc_edit").val(row_edit_accidente[i]['dept_id']).change();
$("#select_unidad_Acc_edit").val(row_edit_accidente[i]['id_unidad']).change();
//Seteamos valores de input

$("#conductor_acc_edit").val(row_edit_accidente[i]['conductor_acc']);
$("#licencia_acc_edit").val(row_edit_accidente[i]['licencia_acc']);
$("#tipo_lic_acc_edit").val(row_edit_accidente[i]['tipo_lic_acc']);
$("#expiracion_lic_edit").val(row_edit_accidente[i]['expiracion_lic']);
$("#direc_cond_acc_edit").val(row_edit_accidente[i]['direc_cond_acc']);
$("#telf_cond_acc_edit").val(row_edit_accidente[i]['telf_cond_acc']);
$("#edad_cond_acc_edit").val(row_edit_accidente[i]['edad_cond_acc']);

$("#fecha_acc_edit").val(row_edit_accidente[i]['fecha_acc']);
$("#hora_acc_edit").val(row_edit_accidente[i]['hora_acc']);
$("#boleta_poli_acc_edit").val(row_edit_accidente[i]['boleta_poli_acc']);
$("#boleta_aseg_acc_edit").val(row_edit_accidente[i]['boleta_aseg_acc']);

$("#provincia_acc_edit").val(row_edit_accidente[i]['provincia_acc']);
$("#canton_acc_edit").val(row_edit_accidente[i]['canton_acc']);
$("#calle_acc_edit").val(row_edit_accidente[i]['calle_acc']);
$("#avenida_acc_edit").val(row_edit_accidente[i]['avenida_acc']);
$("#lugar_acc_edit").val(row_edit_accidente[i]['lugar_acc']);

//console.log('segun detalle clasificacion accidente:'+row_edit_accidente[i]['clasificacion_acc']);

$("#casificacion_acc_edit").val(row_edit_accidente[i]['clasificacion_acc']).change();
$("#tipo_acc_edit").val(row_edit_accidente[i]['tipo_accidente']).change();
$("#tipo_carrt_acc_edit").val(row_edit_accidente[i]['estado_carretera']).change();

//---detalle firma
$("#visor_firma_edit").attr('src',row_edit_accidente[i]['file_firma']);

$("#clima_acc_edit").val(row_edit_accidente[i]['clima_acc']);
$("#explicacion_acc_edit").val(row_edit_accidente[i]['explicacion_acc']);

$("#marca_otro1_edit").val(row_edit_accidente[i]['marca_otro1']);
$("#tipo_otro1_edit").val(row_edit_accidente[i]['tipo_otro1']);
$("#placa_otro1_edit").val(row_edit_accidente[i]['placa_otro1']);
$("#danio_otro1_edit").val(row_edit_accidente[i]['danio_otro1']);
$("#propietario_otro1_edit").val(row_edit_accidente[i]['propietario_otro1']);
$("#direccion_otro1_edit").val(row_edit_accidente[i]['direccion_otro1']);
$("#telefono_otro1_edit").val(row_edit_accidente[i]['telefono_otro1']);

$("#marca_otro2_edit").val(row_edit_accidente[i]['marca_otro2']);
$("#tipo_otro2_edit").val(row_edit_accidente[i]['tipo_otro2']);
$("#placa_otro2_edit").val(row_edit_accidente[i]['placa_otro2']);
$("#danio_otro2_edit").val(row_edit_accidente[i]['danio_otro2']);
$("#propietario_otro2_edit").val(row_edit_accidente[i]['propietario_otro2']);
$("#direccion_otro2_edit").val(row_edit_accidente[i]['direccion_otro2']);
$("#telefono_otro2_edit").val(row_edit_accidente[i]['telefono_otro2']);

$("#marca_otro3_edit").val(row_edit_accidente[i]['marca_otro3']);
$("#tipo_otro3_edit").val(row_edit_accidente[i]['tipo_otro3']);
$("#placa_otro3_edit").val(row_edit_accidente[i]['placa_otro3']);
$("#danio_otro3_edit").val(row_edit_accidente[i]['danio_otro3']);
$("#propietario_otro3_edit").val(row_edit_accidente[i]['propietario_otro3']);
$("#direccion_otro3_edit").val(row_edit_accidente[i]['direccion_otro3']);
$("#telefono_otro3_edit").val(row_edit_accidente[i]['telefono_otro3']);

$("#marca_otro4_edit").val(row_edit_accidente[i]['marca_otro4']);
$("#tipo_otro4_edit").val(row_edit_accidente[i]['tipo_otro4']);
$("#placa_otro4_edit").val(row_edit_accidente[i]['placa_otro4']);
$("#danio_otro4_edit").val(row_edit_accidente[i]['danio_otro4']);
$("#propietario_otro4_edit").val(row_edit_accidente[i]['propietario_otro4']);
$("#direccion_otro4_edit").val(row_edit_accidente[i]['direccion_otro4']);
$("#telefono_otro4_edit").val(row_edit_accidente[i]['telefono_otro4']);

$("#nombre_pas_edit").val(row_edit_accidente[i]['nombre_pas']);
$("#identificacion_pas_edit").val(row_edit_accidente[i]['identificacion_pas']);
$("#direccion_pas_edit").val(row_edit_accidente[i]['direccion_pas']);
$("#telefono_pass_edit").val(row_edit_accidente[i]['vehiculo_pass']);
$("#vehiculo_pass_edit").val(row_edit_accidente[i]['nombre_pas1']);

$("#nombre_pas1_edit").val(row_edit_accidente[i]['nombre_pas1']);
$("#identificacion_pas1_edit").val(row_edit_accidente[i]['identificacion_pas1']);
$("#direccion_pas1_edit").val(row_edit_accidente[i]['direccion_pas1']);
$("#telefono_pas1_edit").val(row_edit_accidente[i]['telefono_pas1']);
$("#vehiculo_pass1_edit").val(row_edit_accidente[i]['vehiculo_pass1']);

$("#nombre_pas2_edit").val(row_edit_accidente[i]['nombre_pas2']);
$("#identificacion_pas2_edit").val(row_edit_accidente[i]['identificacion_pas2']);
$("#direccion_pas2_edit").val(row_edit_accidente[i]['direccion_pas2']);
$("#telefono_pas2_edit").val(row_edit_accidente[i]['telefono_pas2']);
$("#vehiculo_pass2_edit").val(row_edit_accidente[i]['vehiculo_pass2']);

$("#nombre_testigo_edit").val(row_edit_accidente[i]['nombre_testigo']);
$("#identificacion_testigo_edit").val(row_edit_accidente[i]['identificacion_testigo']);
$("#direccion_testigo_edit").val(row_edit_accidente[i]['direccion_testigo']);
$("#telefono_testigo_edit").val(row_edit_accidente[i]['telefono_testigo']);

$("#nombre_testigo1_edit").val(row_edit_accidente[i]['nombre_testigo1']);
$("#identificacion_testigo1_edit").val(row_edit_accidente[i]['identificacion_testigo1']);
$("#direccion_testigo1_edit").val(row_edit_accidente[i]['direccion_testigo1']);
$("#telefono_testigo1_edit").val(row_edit_accidente[i]['telefono_testigo1']);

$("#nombre_lesionados_edit").val(row_edit_accidente[i]['nombre_lesionados']);
$("#identificacion_lesionados_edit").val(row_edit_accidente[i]['identificacion_lesionados']);
$("#direccion_lesionados_edit").val(row_edit_accidente[i]['direccion_lesionados']);
$("#tipo_lesion_edit").val(row_edit_accidente[i]['tipo_lesion']);

$("#nombre_lesionados1_edit").val(row_edit_accidente[i]['nombre_lesionados1']);
$("#identificacion_lesionados1_edit").val(row_edit_accidente[i]['identificacion_lesionados1']);
$("#direccion_lesionados1_edit").val(row_edit_accidente[i]['direccion_lesionados1']);
$("#tipo_lesion1_edit").val(row_edit_accidente[i]['tipo_lesion1']);

$("#nombre_lesionados2_edit").val(row_edit_accidente[i]['nombre_lesionados2']);
$("#identificacion_lesionados2_edit").val(row_edit_accidente[i]['identificacion_lesionados2']);
$("#direccion_lesionados2_edit").val(row_edit_accidente[i]['direccion_lesionados2']);
$("#tipo_lesion2_edit").val(row_edit_accidente[i]['tipo_lesion2']);

$("#nombre_lesionados3_edit").val(row_edit_accidente[i]['nombre_lesionados3']);
$("#identificacion_lesionados3_edit").val(row_edit_accidente[i]['identificacion_lesionados3']);
$("#direccion_lesionados3_edit").val(row_edit_accidente[i]['direccion_lesionados3']);
$("#tipo_lesion3_edit").val(row_edit_accidente[i]['tipo_lesion3']);

$("#nombre_lesionados4_edit").val(row_edit_accidente[i]['nombre_lesionados4']);
$("#identificacion_lesionados4_edit").val(row_edit_accidente[i]['identificacion_lesionados4']);
$("#direccion_lesionados4_edit").val(row_edit_accidente[i]['direccion_lesionados4']);
$("#tipo_lesion4_edit").val(row_edit_accidente[i]['tipo_lesion4']);

$("#nombre_lesionados5_edit").val(row_edit_accidente[i]['nombre_lesionados5']);
$("#identificacion_lesionados5_edit").val(row_edit_accidente[i]['identificacion_lesionados5']);
$("#direccion_lesionados5_edit").val(row_edit_accidente[i]['direccion_lesionados5']);
$("#tipo_lesion5_edit").val(row_edit_accidente[i]['tipo_lesion5']);

$("#nombre_peaton_edit").val(row_edit_accidente[i]['nombre_peaton']);
$("#identificacion_peaton_edit").val(row_edit_accidente[i]['identificacion_peaton']);
$("#direccion_peaton_edit").val(row_edit_accidente[i]['direccion_peaton']);
$("#tipo_lesion_peaton_edit").val(row_edit_accidente[i]['tipo_lesion_peaton']);

$("#relato_acc_edit").val(row_edit_accidente[i]['relato_acc']);

//-----parseamos detalle de fotos--------
 var fotosUpdate=row_edit_accidente[i]['file_fotos'];
 var fotosArrayUpdate=fotosUpdate.split(",");
 
  for(var a=0; a < fotosArrayUpdate.length; a++){

         var ruta_foto=fotosArrayUpdate[a];

        if(ruta_foto!=''){
         var count = $('.container_editAcc .content').length;
                count = Number(count) + 1;

         $('.container_editAcc').append("<div class='content' id='AccUpcontent_"+count+"' ><img src='"+ruta_foto+"' width='100' height='100'><Button class='delete' id='deleteEditAcc_"+count+"'>Delete</button></div>");

         //console.log('contenido:  AccUpcontent_'+count);

         ArregloUpdateFotosAccidente.push(ruta_foto);
		 }
		 
         }
 

}//si  es identico el id

}//fin de for de accidentes


 
$("#popupAccidente").show();
//console.log('editaremos');


}//----------------fin de funcion editar


//funcion de actualziar select de paises- departamentos
$('#pais_acc_edit').change(function(){
 var miopcion=$(this).find("option:selected").attr('value');

  $('#dept_acc_edit').html('');
  
   for(var i=0; i < ArrayIdDept.length; i++){
       if(miopcion==ArrayPaisDept[i]){
         $('#dept_acc_edit').append('<option value="'+ArrayIdDept[i]+'">'+ArrayNombreDept[i]+'</option>');
	    }
    }	
		
  $('#dept_acc_edit').selectmenu('refresh', true);	
		
});


    
//---adminitracion de fotos de edicion de Accidente-----	
$("#but_upload_editAcc").click(function(){

var count = $('.container_editAcc .content').length;
    count = Number(count);

 if(count < 10){


  var fd = new FormData();
  var files = $('#file_editAcc')[0].files[0];
  fd.append('file',files);
  fd.append('request',1);
  fd.append('empresa',empresa_activa);

  // AJAX request
  $.ajax({
   url: 'http://191.98.228.86/GestionFlotaFiles/HandleFotosAccidentes.php',
   type: 'post',
   data: fd,
   contentType: false,
   processData: false,
   beforeSend: function() {
   $("#but_upload_editAcc").prop('disabled', true);
   $.mobile.loading('show');
   },
   success: function(response){
     
     if(response != 0){
	 $("#but_upload_editAcc").prop('disabled', false);
	 //console.log(response);
	 
       var count = $('.container_editAcc .content').length;
       count = Number(count) + 1;

       // Show image preview with Delete button
       $('.container_editAcc').append("<div class='content' id='AccUpcontent_"+count+"' ><img src='"+response+"' width='100' height='100'><Button class='delete' id='deleteEditAcc_"+count+"'>Delete</button></div>");
        ArregloUpdateFotosAccidente.push(response);
        $.mobile.loading('hide');
	 }else{
         $.mobile.loading('hide');
	     $.alert({title: 'Error!',content: 'file not uploadeds'}); 
	   
     }
   }
  });

 }else{
    $.alert({title: 'Informacion:',content: 'solo se permiten 10 imagenes'});
   }


 });


//--eliminacion de fotos desde edicion de Accidente------

$('.container_editAcc').on('click','.content .delete',function(){
  
   var id = this.id;
   var split_id = id.split('_');
   var num = split_id[1];

   // Get image source
   var imgElement_src = $( '#AccUpcontent_'+num+' img' ).attr("src");

//console.log('removeremos:#AccUpcontent_'+num);
   $('#AccUpcontent_'+num).remove(); 

   for(var i=0; i < ArregloUpdateFotosAccidente.length;i++){
       if(ArregloUpdateFotosAccidente[i]==imgElement_src){
       ArregloUpdateFotosAccidente[i]='';
      }

     }
   //console.log('borramos:'+imgElement_src);
  
  
  });//fin de eliminar 


$("#btn_cancel_acc_edit").click(function(){ 
     $("#popupAccidente").hide();
});


//---- guardamos edicion de Accidente-- con nuevos datos ingresados

$("#btn_update_acc_edit").click(function(){ 
    
var banderaActualizar=true;



if(($("#conductor_acc_edit").val()=='')||($("#licencia_acc_edit").val()=='')
||($("#tipo_lic_acc_edit").val()=='')||($("#expiracion_lic_edit").val()=='')
||($("#direc_cond_acc_edit").val()=='')||($("#telf_cond_acc_edit").val()=='')
||($("#edad_cond_acc_edit").val()=='')){
banderaActualizar=false;
 $("#Datos_conductor_edit").collapsible('expand');
}
	
	
if(($("#clima_acc_edit").val()=='')||($("#explicacion_acc_edit").val()=='')){
  banderaActualizar=false;
  $("#Estado_Carretera_edit").collapsible('expand');
}


if(($("#fecha_acc_edit").val()=='')||($("#hora_acc_edit").val()=='')||
($("#boleta_poli_acc_edit").val()=='')||($("#boleta_aseg_acc_edit").val()=='')){
banderaActualizar=false;
 $("#fecha_accidente_edit").collapsible('expand');
}

if(($("#provincia_acc_edit").val()=='')||
($("#canton_acc_edit").val()=='')||
($("#calle_acc_edit").val()=='')||
($("#avenida_acc_edit").val()=='')||
($("#lugar_acc_edit").val()=='')){
banderaActualizar=false;
$("#lugar_accidente_edit").collapsible('expand');
}


if($("#relato_acc_edit").val()==''){
banderaActualizar=false;
$("#Relato_edit").collapsible('expand');
}

if(banderaActualizar==false){
$.alert({title: 'alerta!',content: 'algunos campos aun no han sido llenados'});
}	
	
	
	
	
var ImagenesValidas=false;
for(var i=0; i < ArregloUpdateFotosAccidente.length;i++){
	if(ArregloUpdateFotosAccidente[i]!=''){
			ImagenesValidas=true;	    
	}
}

if(ImagenesValidas==false){
banderaActualizar=false
$("#Fotos_edit").collapsible('expand');
$.alert({title: 'alerta!',content: 'debes seleccionar y cargar una foto almenos'});
}


var datosPostAccidente=[];
var arregloAccidente={};

arregloAccidente['conductor_acc']=$('#conductor_acc_edit').val();
arregloAccidente['licencia_acc']=$('#licencia_acc_edit').val();
arregloAccidente['tipo_lic_acc']=$('#tipo_lic_acc_edit').val();
arregloAccidente['expiracion_lic']=$('#expiracion_lic_edit').val();
arregloAccidente['direc_cond_acc']=$('#direc_cond_acc_edit').val();
arregloAccidente['telf_cond_acc']=$('#telf_cond_acc_edit').val();
arregloAccidente['edad_cond_acc']=$('#edad_cond_acc_edit').val();

arregloAccidente['fecha_acc']=$('#fecha_acc_edit').val();
arregloAccidente['hora_acc']=$('#hora_acc_edit').val();
arregloAccidente['boleta_poli_acc']=$('#boleta_poli_acc_edit').val();
arregloAccidente['boleta_aseg_acc']=$('#boleta_aseg_acc_edit').val();

arregloAccidente['provincia_acc']=$('#provincia_acc_edit').val();
arregloAccidente['canton_acc']=$('#canton_acc_edit').val();
arregloAccidente['calle_acc']=$('#calle_acc_edit').val();
arregloAccidente['avenida_acc']=$('#avenida_acc_edit').val();
arregloAccidente['lugar_acc']=$('#lugar_acc_edit').val();


//---pasando valores de select en edicion----
arregloAccidente['clasificacion_acc']=$("#casificacion_acc_edit").val();
arregloAccidente['tipo_accidente']=$("#tipo_acc_edit").val();
arregloAccidente['estado_carretera']=$("#tipo_carrt_acc_edit").val();

arregloAccidente['clima_acc']=$('#clima_acc_edit').val();
arregloAccidente['explicacion_acc']=$('#explicacion_acc_edit').val();

arregloAccidente['marca_otro1']=$('#marca_otro1_edit').val();
arregloAccidente['tipo_otro1']=$('#tipo_otro1_edit').val();
arregloAccidente['placa_otro1']=$('#placa_otro1_edit').val();
arregloAccidente['danio_otro1']=$('#danio_otro1_edit').val();
arregloAccidente['propietario_otro1']=$('#propietario_otro1_edit').val();
arregloAccidente['direccion_otro1']=$('#direccion_otro1_edit').val();
arregloAccidente['telefono_otro1']=$('#telefono_otro1_edit').val();

arregloAccidente['marca_otro2']=$('#marca_otro2_edit').val();
arregloAccidente['tipo_otro2']=$('#tipo_otro2_edit').val();
arregloAccidente['placa_otro2']=$('#placa_otro2_edit').val();
arregloAccidente['danio_otro2']=$('#danio_otro2_edit').val();
arregloAccidente['propietario_otro2']=$('#propietario_otro2_edit').val();
arregloAccidente['direccion_otro2']=$('#direccion_otro2_edit').val();
arregloAccidente['telefono_otro2']=$('#telefono_otro2_edit').val();

arregloAccidente['marca_otro3']=$('#marca_otro3_edit').val();
arregloAccidente['tipo_otro3']=$('#tipo_otro3_edit').val();
arregloAccidente['placa_otro3']=$('#placa_otro3_edit').val();
arregloAccidente['danio_otro3']=$('#danio_otro3_edit').val();
arregloAccidente['propietario_otro3']=$('#propietario_otro3_edit').val();
arregloAccidente['direccion_otro3']=$('#direccion_otro3_edit').val();
arregloAccidente['telefono_otro3']=$('#telefono_otro3_edit').val();

arregloAccidente['marca_otro4']=$('#marca_otro4_edit').val();
arregloAccidente['tipo_otro4']=$('#tipo_otro4_edit').val();
arregloAccidente['placa_otro4']=$('#placa_otro4_edit').val();
arregloAccidente['danio_otro4']=$('#danio_otro4_edit').val();
arregloAccidente['propietario_otro4']=$('#propietario_otro4_edit').val();
arregloAccidente['direccion_otro4']=$('#direccion_otro4_edit').val();
arregloAccidente['telefono_otro4']=$(telefono_otro4_edit).val();

arregloAccidente['nombre_pas']=$('#nombre_pas_edit').val();
arregloAccidente['identificacion_pas']=$('#identificacion_pas_edit').val();
arregloAccidente['direccion_pas']=$('#direccion_pas_edit').val();
arregloAccidente['telefono_pass']=$('#telefono_pass_edit').val();
arregloAccidente['vehiculo_pass']=$('#vehiculo_pass_edit').val();

arregloAccidente['nombre_pas1']=$('#nombre_pas1_edit').val();
arregloAccidente['identificacion_pas1']=$('#identificacion_pas1_edit').val();
arregloAccidente['direccion_pas1']=$('#direccion_pas1_edit').val();
arregloAccidente['telefono_pas1']=$('#telefono_pas1_edit').val();
arregloAccidente['vehiculo_pass1']=$('#vehiculo_pass1_edit').val();

arregloAccidente['nombre_pas2']=$('#nombre_pas2_edit').val();
arregloAccidente['identificacion_pas2']=$('#identificacion_pas2_edit').val();
arregloAccidente['direccion_pas2']=$('#direccion_pas2_edit').val();
arregloAccidente['telefono_pas2']=$('#telefono_pas2_edit').val();
arregloAccidente['vehiculo_pass2']=$('#vehiculo_pass2_edit').val();

arregloAccidente['nombre_testigo']=$('#nombre_testigo_edit').val();
arregloAccidente['identificacion_testigo']=$('#identificacion_testigo_edit').val();
arregloAccidente['direccion_testigo']=$('#direccion_testigo_edit').val();
arregloAccidente['telefono_testigo']=$('#telefono_testigo_edit').val();

arregloAccidente['nombre_testigo1']=$('#nombre_testigo1_edit').val();
arregloAccidente['identificacion_testigo1']=$('#identificacion_testigo1_edit').val();
arregloAccidente['direccion_testigo1']=$('#direccion_testigo1_edit').val();
arregloAccidente['telefono_testigo1']=$('#telefono_testigo1_edit').val();

arregloAccidente['nombre_lesionados']=$('#nombre_lesionados_edit').val();
arregloAccidente['identificacion_lesionados']=$('#identificacion_lesionados_edit').val();
arregloAccidente['direccion_lesionados']=$('#direccion_lesionados_edit').val();
arregloAccidente['tipo_lesion']=$('#tipo_lesion_edit').val();

arregloAccidente['nombre_lesionados1']=$('#nombre_lesionados1_edit').val();
arregloAccidente['identificacion_lesionados1']=$('#identificacion_lesionados1_edit').val();
arregloAccidente['direccion_lesionados1']=$('#direccion_lesionados1_edit').val();
arregloAccidente['tipo_lesion1']=$('#tipo_lesion1_edit').val();

arregloAccidente['nombre_lesionados2']=$('#nombre_lesionados2_edit').val();
arregloAccidente['identificacion_lesionados2']=$('#identificacion_lesionados2_edit').val();
arregloAccidente['direccion_lesionados2']=$('#direccion_lesionados2_edit').val();
arregloAccidente['tipo_lesion2']=$('#tipo_lesion2_edit').val();

arregloAccidente['nombre_lesionados3']=$('#nombre_lesionados3_edit').val();
arregloAccidente['identificacion_lesionados3']=$('#identificacion_lesionados3_edit').val();
arregloAccidente['direccion_lesionados3']=$('#direccion_lesionados3_edit').val();
arregloAccidente['tipo_lesion3']=$('#tipo_lesion3_edit').val();

arregloAccidente['nombre_lesionados4']=$('#nombre_lesionados4_edit').val();
arregloAccidente['identificacion_lesionados4']=$('#identificacion_lesionados4_edit').val();
arregloAccidente['direccion_lesionados4']=$('#direccion_lesionados4_edit').val();
arregloAccidente['tipo_lesion4']=$('#tipo_lesion4_edit').val();

arregloAccidente['nombre_lesionados5']=$('#nombre_lesionados5_edit').val();
arregloAccidente['identificacion_lesionados5']=$('#identificacion_lesionados5_edit').val();
arregloAccidente['direccion_lesionados5']=$('#direccion_lesionados5_edit').val();
arregloAccidente['tipo_lesion5']=$('#tipo_lesion5_edit').val();

arregloAccidente['nombre_peaton']=$('#nombre_peaton_edit').val();
arregloAccidente['identificacion_peaton']=$('#identificacion_peaton_edit').val();
arregloAccidente['direccion_peaton']=$('#direccion_peaton_edit').val();
arregloAccidente['tipo_lesion_peaton']=$('#tipo_lesion_peaton_edit').val();

arregloAccidente['relato_acc']=$('#relato_acc_edit').val();

var	aInfoAccidenteUpdate = JSON.stringify(arregloAccidente);

	
if(banderaActualizar==true){

$("#btn_update_acc_edit").attr('disabled', true);

 
var file_fotos=ArregloUpdateFotosAccidente.join(",");
var unidad_accidente_enviar=$('#select_unidad_Acc_edit').val();

var departamento_acc_enviar=$('#dept_acc_edit').val();
var fecha_accidente_enviar=$('#fecha_acc_edit').val();
var pais_accidente_enviar=$('#pais_acc_edit').val();

var id_accidente=$("#id_update_accidente").val();

 $.ajax({
        url: 'http://191.98.228.86/GestionFlota_ApiRest/UpdateAccidente',
        type: 'post',
        data: {
		'id_accidente':id_accidente,
		'array_datos':aInfoAccidenteUpdate, 
        'usuario':id_usuario,
        'empresa':empresa_activa,
        'nombreusuario':logeado,
        'vehiculo':unidad_accidente_enviar,
        'dept_id':departamento_acc_enviar,
        'fecha_accidente':fecha_accidente_enviar,
        'pais':pais_accidente_enviar,
        'file_fotos':file_fotos,
        'id_session':id_session
		},
        success: function(response){
		
		 $("#btn_update_acc_edit").attr('disabled', false);
			$.alert({title: 'alerta!',content:response});
			
			//reinciar tabla si es correcto el update
			if(response[0]=='Detalle Accidente actualizado'){
			   $("#popupAccidente").hide();
			   CargarHistorialAccidentes();
			 
			}
			
			
        },error:  function (jqXHR, textStatus, errorThrown){
	                         var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }
	                     $.alert({title: 'Error!',content:errorResponse});
                   }
      });


}
	
	
		
	
});//fin de guardar edicion de accidente



function cancelarAccidente(id){

//console.log('usuario:'+id_usuario+',empresa:'+empresa_activa+',id_accidente:'+id);
  
   $.confirm({
    title: 'Importante!',
    content: '¿deseas borrar registro?',
    buttons: {
        confirm: function () {
            $.ajax({
                 type: "POST",
                 url: "http://191.98.228.86/GestionFlota_ApiRest/BorrarAccidente",
                 data: { 
				 'usuario':id_usuario,
				 'nombreusuario':logeado,
				 'empresa':empresa_activa,
				 'id_accidente':id,
                 'id_session':id_session
                       },
                        beforeSend: function() {
                          $.mobile.loading('show');
                        },
                        success: function (data) {
					
                            $.mobile.loading('hide');
                           
							if(data[0]=='Registro Accidente Borrado'){
							 $.alert({title: 'Exitoso:',content: data});
							 CargarHistorialAccidentes();
						   }else{
						    $.alert({title: 'Alerta!',content: data});
						   }
							
                       },
                         error:  function (jqXHR, textStatus, errorThrown){
	                         var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }
	                     $.alert({title: 'Error!',content:errorResponse});
                   }
                });

                 //fin de ajax


        },
        cancel: function () {
            $.alert('Sin accion!');
        }
    }
});
   
}//borrar registro de accidente









/*  -----------------__________________------------------------ */

/*  ----------------pagina de Entregas y Recpecion----------------------- */

/*  -----------------__________________------------------------ */


$('#link_nuevaEntrega').bind("tap", function() {
if((id_usuario=='')||(empresa_activa=='')){
  $.mobile.changePage("#inicio");
 }else{
    $.mobile.changePage("#pg_recepcionEntrega");
	 CargarItemsEntrega();
   
	}
});

$('#atras_recepecion_entrega').bind("tap", function() {
if((id_usuario=='')||(empresa_activa=='')){
  $.mobile.changePage("#inicio");
 }else{
  $.mobile.changePage("#home");
 
  }
});



//----- cargamos catalogo de item para entregar o recibir vehiculo----
  
  var  id_opcionArray_en=[];
  var nombre_opcionArray_en=[];


function CargarItemsEntrega(){

   $.mobile.loading('show');
   $("#tbody_items_en").html("");
   
   id_opcionArray_en.length=0;
   nombre_opcionArray_en.lenght=0;
   
  $.ajax({
        type: "POST",
        url: "http://191.98.228.86/GestionFlota_ApiRest/listarOpcionesEntrega",
        data: {"empresa":empresa_activa},
        success: function (data) {
		$.mobile.loading('hide');
          var iteracion=1;
            $.each(data, function (index){
			
			if (!data[0]){$.alert({title: 'Error:',content: 'Sin Registros de Items Entregas'});};

              var id_opcion=data[index].id;
              var nombre_opcion=data[index].nombre_opcion_en;
           
               id_opcionArray_en.push(id_opcion);
			   nombre_opcionArray_en.push(nombre_opcion);
			   
			 if(iteracion % 2 == 0) {
               var color='#F4F4F8';
              }else {
                 var color='#ede7f6';
              }
			
	 
		 
         $('#tbody_items_en').append('<tr id="EN'+id_opcion+'" value='+id_opcion+' class="id_row" style="background-color:'+color+'"><td>'+
		 iteracion+'</td><td>'+nombre_opcion+'</td><td><strong>'+
		 '<input type="checkbox" name="SI" class="encheck_EN'+id_opcion+'" value="1" style="margin-left:15px;">SI'+
		 '<input type="checkbox" name="NO" class="encheck_EN'+id_opcion+'" value="2" style="margin-left:15px;">NO</input>'+
		 '</strong></td><tr>' );
         iteracion++;
            

			});

       $("#my-table-en").table("refresh");
	   
      },error: function (jqXHR, textStatus, errorThrown) {
                             var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse});
	                     CargarItemsEntrega();
	}

});




$("#my-table-en").on('change',"input[type='checkbox']",function(e){
             //your code 
         	  

         	var title = $(this).attr('name');//atributo nombre del check
             var tr_id = $(this).parents('tr:first').attr('id'); // id de fila contenido
         	
         	var itemSeleccionado=$(this).val();
         	
              //$.alert({title: 'mensaje:',content: 'name:'+title+', item:'+tr_id});
                   //console.log('item check seleccionado:'+itemSeleccionado) ;        		
				
         	//verifica que solo el que acabamos de poner quede activo
         	$('input.encheck_'+tr_id+':checkbox:checked').each(function () {
			
         	     var Valoriteracion = $(this).val();
				 //console.log('iterando:'+Valoriteracion);
         		 
         	     if(itemSeleccionado!=Valoriteracion){
         		 $(this).prop( "checked", false );
				  //console.log('diferente'+itemSeleccionado+'->'+Valoriteracion);
         		 } 
              }); 
  });





}//fin de metodo cargar



//-----Manejo de fotos para Entrega Recepcion----

var ArregloInsertFotosEN=[];

var SubidosFiles=[];


// agregando imagenes
$("#but_upload_en").click(function(){


var count = $('.containerFile .content').length;
       count = Number(count);
   
   if(count < 10){

  var fd = new FormData();
  var files = $('#file_en')[0].files[0];
  fd.append('file',files);
  fd.append('request',1);
  fd.append('empresa',empresa_activa);



 var EncontradoFile=false;
 // console.log($('#file_en').val());
  
  for(var z=0; z < SubidosFiles.length; z++){
  if(SubidosFiles[z]==$('#file_en').val()){
  
  EncontradoFile=true;
   $.alert({title: 'Advertencia:',content: 'imagen repetida'});
  }
  
  }



if(EncontradoFile==false){
  SubidosFiles.push($('#file_en').val());
  





  // AJAX request
  $.ajax({
   url: 'http://191.98.228.86/GestionFlotaFiles/HandleFileEntrega.php',
   type: 'post',
   data: fd,
   contentType: false,
   processData: false,
   beforeSend: function() {
    $("#but_upload_en").prop('disabled', true);
      $.mobile.loading('show');
   },
   success: function(response){
    
    $("#but_upload_en").prop('disabled', false);
     if(response != 0){
	// console.log(response);
       var count = $('.containerFile .content').length;
       count = Number(count) + 1;

       // Show image preview with Delete button
       $('.containerFile').append("<div class='content' id='ENcontent_"+count+"' ><img src='"+response+"'  class='itemsFoto' width='100' height='100'><Button class='delete' id='delete_"+count+"'>Delete</button></div>");
        ArregloInsertFotosEN.push(response);
         $.mobile.loading('hide');
        $('#file_en').val("");
	 }else{
        $.mobile.loading('hide');
	     $.alert({title: 'Error!',content: 'file not uploadeds'}); 
     }
   }
  });

}

}else{
    $.alert({title: 'Informacion:',content: 'solo se permiten 10 imagenes'});
   }


 });





$('.containerFile').on('click','.content .itemsFoto',function(){
 $("#viewPictures").popup("open"); 
    
     var foto_a_ver=$(this).attr("src");
     $("#imagen_popup").attr("src",foto_a_ver);
});



var CantidadClic=0;

$('#giro_imagen').click(function(){

 if(CantidadClic==0){
   $("#imagen_popup").css({'transform': 'rotate(-90deg)','width':'290px','height':'290px'}); 
   CantidadClic++;
 }else if(CantidadClic==1){
    $("#imagen_popup").css({'transform': 'rotate(-180deg)','width':'290px','height':'290px'});
    CantidadClic++;
 }else if(CantidadClic==2){
   $("#imagen_popup").css({'transform': 'rotate(-270deg)','width':'290px','height':'290px'});
   CantidadClic++;
 }else if(CantidadClic==3){ 
 $("#imagen_popup").css({'transform': 'rotate(-0deg)','width':'290px','height':'290px'}); 
   CantidadClic=0;
 }
 
 
 });










 // Borrado imagenes
$('.containerFile').on('click','.content .delete',function(){

  var id = this.id;
  var split_id = id.split('_');
  var num = split_id[1];

  // Get image source
  var imgElement_src = $( '#ENcontent_'+num+' img' ).attr("src");
  
 // console.log('borramos:'+imgElement_src);
  
  
  $.confirm({
    title: 'Importante!',
    content: '¿realmente deseas eliminarlo?',
    buttons: {
      confirm: function () {
	  
	
              $('#ENcontent_'+num).remove(); 
			  
			   for(var i=0; i < ArregloInsertFotosEN.length;i++){
			        if(ArregloInsertFotosEN[i]==imgElement_src){
				       ArregloInsertFotosEN[i]='';
				      }
			    }
            
	 
        },
        cancel: function () {
            $.alert('Sin accion!');
        }
    }
});
  
  
  
 
}); 




// -------- ---manejo de firmas de Entrega--------  -----------


var signaturePad_en = new SignaturePad(document.getElementById('signature-pad_en'));
var dataURL_img_en='';

$('#clear_en').bind("click", function() {

  signaturePad_en.on();
  signaturePad_en.clear();
  dataURL_img_en='';
$('#saved_signed_en').prop("checked", false).checkboxradio("refresh");
  //console.log('clic en limpiar')
});


$('#saved_signed_en').change(function() {

if(this.checked){
   if(signaturePad_en.isEmpty()){
       $.alert({title: 'alerta!',content: 'debes ingresar una firma'});
	   $('#saved_signed_en').prop('checked', false);
    }else{
      dataURL_img_en = signaturePad_en.toDataURL();
      dataURL_img_en=dataURL_img_en.replace(/^data:image\/(png|jpg);base64,/, "");
     // console.log(dataURL_img_en);
      signaturePad_en.off();
   }
 }else{
    signaturePad_en.on();
 }          
});



// -------- ---manejo de firmas de Recepcion--------  -----------


var signaturePad_re = new SignaturePad(document.getElementById('signature-pad_re'));
var dataURL_img_re='';

$('#clear_re').bind("click", function() {

  signaturePad_re.on();
  signaturePad_re.clear();
  dataURL_img_re='';
  //console.log('clic en limpiar')
$('#saved_signed_re').prop("checked", false).checkboxradio("refresh");
});


$('#saved_signed_re').change(function() {

if(this.checked){
   if(signaturePad_re.isEmpty()){
       $.alert({title: 'alerta!',content: 'debes ingresar una firma'});
	   $('#saved_signed_re').prop('checked', false);
    }else{
      dataURL_img_re = signaturePad_re.toDataURL();
      dataURL_img_re=dataURL_img_re.replace(/^data:image\/(png|jpg);base64,/, "");
      //console.log(dataURL_img_re);
      signaturePad_re.off();
   }
 }else{
    signaturePad_re.on();
 }            
});

 
 
 
 // -------- ---Guardando gestion de Recepcion--------  -----------

 
$('#BtnGuardarEn').bind("tap", function() {

texto_sin_check='';    
	banderaInsertar=true;

var select_unidad_en=$("#select_unidad_en").val();

var select_tipo_en=$("#select_tipo_en").val();
var km_inicial=$("#km_inicial").val();
var combustible=$("#combustible").val();
var tipo_bateria=$("#tipo_bateria").val();
var nombre_entrego=$("#nombre_entrego").val();
var identificacion_entrego=$("#identificacion_entrego").val();
var nombre_recibe=$("#nombre_recibe").val();
var identificacion_recibe=$("#identificacion_recibe").val();
var observacion_en=$("#observacion_en").val();

if((km_inicial=='')||(combustible=='')||(tipo_bateria=='')||
   (nombre_entrego=='')||(identificacion_entrego=='')||
   (nombre_recibe=='')||(identificacion_recibe=='')){
      $("#Detalles_en").collapsible('expand');
	 banderaInsertar=false;
	 $.alert({title: 'alerta!',content: 'debes completar detalle'});
	 //console.log('ingrese datos de combustible-nombre');
  }

var ImagenesValidas=false;
for(var i=0; i < ArregloInsertFotosEN.length;i++){
	if(ArregloInsertFotosEN[i]!=''){
			ImagenesValidas=true;	    
	}
}

if(ImagenesValidas==false){
banderaInsertar=false;
$("#Datos_fotos_en").collapsible('expand');
$.alert({title: 'alerta!',content: 'debes seleccionar y cargar una foto almenos'});
//console.log('ingrese imagenes');
}

if(dataURL_img_re==''){
banderaInsertar=false;
$.alert({title: 'alerta!',content: 'debes ingresar y aceptar una firma'});
$("#Firmas_en").collapsible('expand');
//console.log('ingrese firma recepcion');
}

if(dataURL_img_en==''){
banderaInsertar=false;
$.alert({title: 'alerta!',content: 'debes ingresar y aceptar una firma'});
$("#Firmas_en").collapsible('expand');
//console.log('ingrese firma entrega');
}

var arreglo_valorinsertar_en=[];
arreglo_valorinsertar_en.lenght=0;

$('#my-table-en tr').each(function() {
   var item =this.id;
   //console.log(item);    
 var banderacheck=false;
$('input.encheck_'+item+':checkbox:checked').each(function () {
 var Valoriteracion = $(this).val();    		 
if($(this).is(':checked')){
    arreglo_valorinsertar_en.push(Valoriteracion);
    banderacheck=true;
 }        	     
});  


if((banderacheck==false)&&($(this).find("td:eq(1)").text()!='')){
var cadena=$(this).find("td:eq(1)").text();
	texto_sin_check=texto_sin_check+',-'+cadena.substr(4);
   //console.log('valor columna:'+$(this).find("td:eq(1)").text());
}

   							  
});


var file_fotos_en=ArregloInsertFotosEN.join(",");
var no_registro=$("#no_registro").val();
var cliente_referencia=$("#referencia").val();



if(banderaInsertar==true){

    var datosPost_en=[];
    datosPost_en.lenght=0;

    // console.log('valor arreglo opciones:'+id_opcionArray_en.length);
    //console.log('cantidad de valores:'+arreglo_valorinsertar_en.length);

if(id_opcionArray_en.length==arreglo_valorinsertar_en.length){

         for(i=0; i<id_opcionArray_en.length;i++){
             var arreglo= {};
             arreglo['id_opcion']=id_opcionArray_en[i];
             arreglo['valor']=arreglo_valorinsertar_en[i];
             datosPost_en.push(arreglo);
            }
         	
         var aInfo_en 	= JSON.stringify(datosPost_en);
		 	 
    $.confirm({
      title: 'Importante!',
      content: '¿deseas registrar detalle entrega?',
      buttons: {
        confirm: function () {
            $.ajax({
                 type: "POST",
                 url: "http://191.98.228.86/GestionFlota_ApiRest/insertarEntrega",
                 data:{
				 'usuario':id_usuario,
	             'unidad':select_unidad_en,
	             'empresa':empresa_activa,
                 'tipo':select_tipo_en,
  	             'kilometraje':km_inicial,
   	             'combustible':combustible,
	             'nombre_tipo_bateria':tipo_bateria,
            	 'nombre_entrego':nombre_entrego,
	             'identificacion_entrego':identificacion_entrego,
	             'nombre_recibe':nombre_recibe,
	             'identificacion_recibe':identificacion_recibe,
	             'file_fotos_en':file_fotos_en,
	             'file_firma_en':dataURL_img_en,
				 'file_firma_re':dataURL_img_re,
				 'observacion_en':observacion_en,
				 'array':aInfo_en,
                 'no_registro':no_registro,
                 'referencia':cliente_referencia,
                 'id_session':id_session

				 },
                  beforeSend: function() {
                          $.mobile.loading('show');
						  $("#BtnGuardarEn").attr('disabled', true);
						 
                      },
                      success: function (data) {
                           $.mobile.loading('hide');
                          
						   if(data[0]=='Entrega registrada'){
						   
						   $.alert({title: 'Exitoso:',content: data});
						   
							  $("#km_inicial").val("");
                              $("#combustible").val("");
                              $("#tipo_bateria").val("");
                              $("#nombre_entrego").val("");
                              $("#identificacion_entrego").val("");
                              $("#nombre_recibe").val("");
                              $("#identificacion_recibe").val("");
                              $("#observacion_en").val("");

                               $("#no_registro").val("");
                              $("#referencia").val("");
							
							  //limpiamos las firmas
							  dataURL_img_re='';
							  signaturePad_re.clear();
							  signaturePad_re.on();
							
                              dataURL_img_en='';
							  signaturePad_en.clear();
							  signaturePad_en.on();
							
							  //limpiamos detalle de fotos
							  ArregloInsertFotosEN.length=0;
							  $(".containerFile").html("");
							
							  //limpiar todos los input checkbox de tabla
							
							 for(i=0; i<id_opcionArray_en.length;i++){
                                 $('input.encheck_EN'+id_opcionArray_en[i]+':checkbox:checked').each(function () {
	                             $(this).prop( "checked", false );
								 //console.log('foreach:'+$(this).val());
		                          }); 
                                }//fin de for de items
							
						    $('#saved_signed_en').prop("checked", false).checkboxradio("refresh");

                             $('#saved_signed_re').prop("checked", false).checkboxradio("refresh");
						
						
						
						    }else{
							$.alert({title: 'alerta!',content: data});
							}
						   
						   $("#BtnGuardarEn").attr('disabled', false);
                       },error: function (jqXHR, textStatus, errorThrown) {
                                 var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse});
                   }
                });

        },
        cancel: function () {
            $.alert('Sin accion!');
        }
    }
});
	
}else{
$.alert({title: 'mensaje:',content: 'Debes completar el checklist: '+texto_sin_check});

//$.alert({title: 'mensaje:',content: 'Debes completar lista de items'});
}
}//fin si podemos insertar
});
 
 
//-----   -----Pagina de Edicion de Entregas-----   ------
 
 
$('#link_historicoEntrega').bind("tap", function() {
if((id_usuario=='')||(empresa_activa=='')){
      $.mobile.changePage("#inicio");
 }else{
         CargarHistoricosEntregas();
        $.mobile.changePage("#historialEntrega");
       
	}
});

$('#atras_historialEN').bind("tap", function() {

if((id_usuario=='')||(empresa_activa=='')){
      $.mobile.changePage("#inicio");
 }else{
        $.mobile.changePage("#home");
	}
});
 
 
var row_edit_en=[];
	

function CargarHistoricosEntregas(){

  row_edit_en.length=0;

 $("#popupEdit_entrega").hide();
 $('#tb_historicoEntrega').html("");

$.ajax({
        type: "POST",
        url: "http://191.98.228.86/GestionFlota_ApiRest/historialEntrega",
        data:{"id_usuario":id_usuario,"id_empresa":empresa_activa},
        beforeSend: function() {
             $.mobile.loading('show');
          },
        success: function (data) {
           $.mobile.loading('hide');
            if (!data[0]){
               $.alert({title: 'Alerta:',content: 'Sin Registros de Recepcion-Entregas'});
            }
			
			//console.log(data);
            $.each(data, function (index){
			
			   var arreglo_item={
			   "id":data[index].id,
			   "id_unidad_en":data[index].id_unidad_en,
			   "nombre_ve":data[index].nombre_ve,
			   "placa_ve":data[index].placa_ve,
			   "fecha_en":data[index].fecha_en,
			   "hora_en":data[index].hora_en,
			   "tipo":data[index].tipo,
			   "kilometraje":data[index].kilometraje,
			   "combustible":data[index].combustible,
			   "nombre_tipo_bateria":data[index].nombre_tipo_bateria,
			   "nombre_entrego":data[index].nombre_entrego,
			   "identificacion_entrego":data[index].identificacion_entrego,
			    "nombre_recibe":data[index].nombre_recibe,
				"identificacion_recibe":data[index].identificacion_recibe,
			   "file_fotos_en":data[index].file_fotos_en,
			   "file_firma_en":data[index].file_firma_en,
			   "file_firma_re":data[index].file_firma_re,
			   "observacion_en":data[index].observacion_en,
			   "insertado_en":data[index].insertado_en,
			   "bandera_edicion":data[index].bandera_edicion,
               "no_registro":data[index].no_registro,
               "referencia":data[index].referencia,
			   "catalogo_entrega":data[index].catalogo_entrega
			   };
			
			   row_edit_en.push(arreglo_item);

               var id_row_en=data[index].id;
			  // console.log('id_registro:'+id_row_en);
			   
               var id_row_unidad_en=data[index].id_unidad_en;
        
               var id_row_tipo=data[index].tipo;
			   var bandera_edicion=data[index].bandera_edicion;
			   var insertado_en=data[index].insertado_en;
			   
			   var placa_row_en=data[index].placa_ve;
               var nombre_ve_row=data[index].nombre_ve;
			   
			   var fecha_row_en=data[index].fecha_en;
            
                if(id_row_tipo==1){
                  var nombre_tipo='Entrega';
                }else if(id_row_tipo==2){
                   var nombre_tipo='Recepcion';
                }
				


        // var texttoedicion='<a href="#popupEdit_entrega"  onClick="EditarEntega('+id_row_en+')"  data-rel="popup"'+'data-position-to="window">Editar</a>';
              

                var texttoedicion='--';



             if(bandera_edicion==1){

                   $('#tb_historicoEntrega').append(
                    '<tr  style="border-bottom: 1px solid #d6d6d6;"><td>'+insertado_en+
                    '</td><td>'+nombre_tipo+':'+nombre_ve_row+'-'+placa_row_en+
                    '</td><td>'+texttoedicion+'</td>'+
                    '<td><a href="" onClick="CancelarEntega('+id_row_en+')">Cancelar</a></td>'+
                    '</tr>');

             }else{

               $('#tb_historicoEntrega').append('<tr style="border-bottom: 1px solid #d6d6d6;"><td>'+
                insertado_en+'</td><td>'+nombre_ve_row+'-'+placa_row_en+'</td>'+
              '<td><label>-</label></td><td><label>-</label></td></tr>');


             }

            }
          );
         $("#gridviewEntrega").table("refresh");
     },
    error: function (jqXHR, textStatus, errorThrown) {
                                var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse});
  }
 });

} //fin de funccion de cargar historial de entegas realizadas


var ArregloUpdateFotos=[];
var numero_up=0;



//----  ---- Opciones de Edicion---- ------
function EditarEntega(id){

$(".containerFileEdit").html('');
$("#Datos_generales_edit_en").collapsible('expand');
ArregloUpdateFotos.length=0;

for(var i=0; i < row_edit_en.length; i++){

if(row_edit_en[i]['id']==id){

$("#id_update_entrega").val(id);
//console.log(row_edit_en[i]['nombre_ve']);

$("#edit_no_registro").val(row_edit_en[i]['no_registro']);
$("#edit_referencia").val(row_edit_en[i]['referencia']);


 $("#select_edit_unidad_en").val(row_edit_en[i]['id_unidad_en']).change();
 $("#select_edit_tipo_en").val(row_edit_en[i]['tipo']).change();
$("#edit_km_inicial").val(row_edit_en[i]['kilometraje']);

$("#edit_combustible").val(row_edit_en[i]['combustible']);
$("#edit_tipo_bateria").val(row_edit_en[i]['nombre_tipo_bateria']);
$("#edit_nombre_entrego").val(row_edit_en[i]['nombre_entrego']);
$("#edit_identificacion_entrego").val(row_edit_en[i]['identificacion_entrego']);
$("#edit_nombre_recibe").val(row_edit_en[i]['nombre_recibe']);
$("#edit_identificacion_recibe").val(row_edit_en[i]['identificacion_recibe']);
$("#edit_observacion_en").val(row_edit_en[i]['observacion_en']);

$("#visor_firma_en").attr('src',row_edit_en[i]['file_firma_en']);
$("#visor_firma_re").attr('src',row_edit_en[i]['file_firma_re']);

//---  -- Cargamos detalle de imagenes -----   -------

var fotosUpdate=row_edit_en[i]['file_fotos_en'];
var fotosArrayUpdate=fotosUpdate.split(",");

for(var a=0; a < fotosArrayUpdate.length; a++){

var ruta_foto=fotosArrayUpdate[a];

if(ruta_foto!=''){
var count = $('.containerFileEdit .content').length;
count = Number(count) + 1;

$('.containerFileEdit').append("<div class='content' id='ENUpcontent_"+count+"' ><img src='"+ruta_foto+"' width='100' height='100'><Button class='delete' id='deleteEdit_"+count+"'>Delete</button></div>");
ArregloUpdateFotos.push(ruta_foto);

}


 	
}



//------   ----------cargamos detalle de checklist----------   ----------

$("#tbody_items_edit_en").html("");

var  catalogo_actualizar_en=row_edit_en[i]['catalogo_entrega'];
var iteracion=1;

//console.log('catalogo:'+row_edit_en[i]['catalogo_entrega']);


jQuery.each( catalogo_actualizar_en, function( i, val ) {

if(iteracion % 2 == 0) {var color='#F4F4F8';}else {var color='#ede7f6'; }

  var textoHaciaTabla_en='<tr id="'+val.id_item+'" value='+val.id_item+' class="id_row_updt_en" style="background-color:'+color+'"><td>'+
  iteracion+'</td><td>'+val.nombre_opcion+'</td><td><strong>';
  
  //console.log('texto:'+textoHaciaTabla_en);
  
  //1 si  --->  //2 no

 if(val.valor_opcion==1){

  textoHaciaTabla_en=textoHaciaTabla_en+'<input type="checkbox" name="SI" class="EnUcheck_'+val.id_item+'" value="1" style="margin-left:15px;" Checked>SI'+
  '<input type="checkbox" name="NO" value="2" class="EnUcheck_'+val.id_item+'" style="margin-left:15px;">NO</input></td><tr>';
  }
  if(val.valor_opcion==2){
  textoHaciaTabla_en=textoHaciaTabla_en+'<input type="checkbox" name="SI" class="EnUcheck_'+val.id_item+'" value="1" style="margin-left:15px;" >SI'+
  '<input type="checkbox" name="NO" value="2" class="EnUcheck_'+val.id_item+'" style="margin-left:15px;" Checked>NO</input></td><tr>';
  }

$('#tbody_items_edit_en').append(textoHaciaTabla_en);
   iteracion++;	   
});

$("#my-table-edit_en").table("refresh");
	
}//si es el registro especifico

}//fin de for de registros


$("#popupEdit_entrega").show();
}//fin de funcion editar fila de entrega
 
 
 
//----  ---- manejo de tabla de items---- ------
$("#my-table-edit_en").on('change',"input[type='checkbox']",function(e){

      var title = $(this).attr('name');//atributo nombre del check
      var tr_id = $(this).parents('tr:first').attr('id'); // id de fila contenido
      var itemSeleccionado=$(this).val();
         	
      //verifica que solo el que acabamos de poner quede activo
      $('input.EnUcheck_'+tr_id+':checkbox:checked').each(function () {
          var Valoriteracion = $(this).val();
         		 
         if(itemSeleccionado!=Valoriteracion){
         	 $(this).prop( "checked", false );
         	 } 
       }); 
}); 
 
 
 
//----  ---- manejo de fotos de entregas o recepcion---- ------ 
     
   //agregando imagenes	 
$("#but_upload_edit_en").click(function(){

var count = $('.containerFileEdit .content').length;
       count = Number(count);


if(count <10){

  var fd = new FormData();
  var files = $('#file_edit_en')[0].files[0];
  fd.append('file',files);
  fd.append('request',1);
  fd.append('empresa',empresa_activa);

  $.ajax({
   url: 'http://191.98.228.86/GestionFlotaFiles/HandleFileEntrega.php',
   type: 'post',
   data: fd,
   contentType: false,
   processData: false,
   beforeSend: function() {
   $.mobile.loading('show');
   $("#but_upload_edit_en").prop('disabled', true);
   },
   success: function(response){
   
    $("#but_upload_edit_en").prop('disabled', false);
     if(response != 0){
	 //console.log(response);
       var count = $('.containerFileEdit .content').length;
       count = Number(count) + 1;

       // Show image preview with Delete button
       $('.containerFileEdit').append("<div class='content' id='ENUpcontent_"+count+"' ><img src='"+response+"' width='100' height='100'><Button class='delete' id='deleteEdit_"+count+"'>Delete</button></div>");
        ArregloUpdateFotos.push(response);
        $.mobile.loading('hide');
	 }else{
       $.mobile.loading('hide');
	     $.alert({title: 'Error!',content: 'file not uploadeds'}); 
     }
   }
  });

}else{
   $.alert({title: 'Informacion:',content: 'solo se permiten 10 imagenes'});
}


 });
 

   // eliminando imagenes 
$('.containerFileEdit').on('click','.content .delete',function(){
 
   var id = this.id;
   var split_id = id.split('_');
   var num = split_id[1];

   // Get image source
   var imgElement_src = $( '#ENUpcontent_'+num+' img' ).attr("src");

   $('#ENUpcontent_'+num).remove(); 
   for(var i=0; i < ArregloUpdateFotos.length;i++){
       if(ArregloUpdateFotos[i]==imgElement_src){
       ArregloUpdateFotos[i]='';
      }

     }
  // console.log('borramos:'+imgElement_src);
  });//fin de eliminar 
 
 
 
 
 //----  ---- Guardamos edicion entregas o recepcion---- ------ 
 
$("#btn_update_en_edit").click(function(){   

var banderaupdateEntrega=true;

var id_resumen_en_edt=$("#id_update_entrega").val();
var id_unidad_en_edt=$("#select_edit_unidad_en").val();
var select_edit_tipo_en_edt=$("#select_edit_tipo_en").val();
var edit_km_inicial_edt=$("#edit_km_inicial").val();

var edit_combustible_en=$("#edit_combustible").val();
var edit_tipo_bateria_en=$("#edit_tipo_bateria").val();
var edit_nombre_entrego_en=$("#edit_nombre_entrego").val();
var edit_identificacion_entrego_en=$("#edit_identificacion_entrego").val();
var edit_nombre_recibe_en=$("#edit_nombre_recibe").val();
var edit_identificacion_recibe_en=$("#edit_identificacion_recibe").val();  
var edit_observacion_entrega=$("#edit_observacion_en").val();

var parametro_no_registro=$("#edit_no_registro").val();
var parametro_referencia=$("#edit_referencia").val();




if((id_resumen_en_edt=='')||(edit_km_inicial_edt=='')||(edit_combustible_en=='')
||(edit_tipo_bateria_en=='')||(edit_nombre_entrego_en=='')||(edit_identificacion_entrego_en=='') 
||(edit_nombre_recibe_en=='')||(edit_identificacion_recibe_en=='')||(edit_observacion_entrega=='')){
$.alert({title: 'alerta!',content:'debes completar todo los campos'});
banderaupdateEntrega=false;
}

var ImagenesValidasUpdate=false;
for(var i=0; i < ArregloUpdateFotos.length;i++){
  if(ArregloUpdateFotos[i]!=''){
       ImagenesValidasUpdate=true;	    
  }
}

if(ImagenesValidasUpdate==false){
    banderaupdateEntrega=false;
    $.alert({title: 'alerta!',content: 'debes seleccionar y cargar una foto almenos'});
 }

var file_fotos_up=ArregloUpdateFotos.join(",");

var arreglo_valor_update=[];
arreglo_valor_update.lenght=0;

var id_items_actualizar=[];
id_items_actualizar.lenght=0;

var contador_filas=0;
 
$('#my-table-edit_en tr').each(function() {
   var item =this.id;
   if(item!=''){
   
   id_items_actualizar.push(item);
   //console.log('numero:'+contador_filas+',id:'+item);    
$('input.EnUcheck_'+item+':checkbox:checked').each(function () {
 var Valoriteracion = $(this).val();    		 
if($(this).is(':checked')){
    arreglo_valor_update.push(Valoriteracion);
 }        	     
}); 
contador_filas++;  
}  							  
});


var datosPost_update=[];
var aInfo_update;

//console.log('contador:'+id_items_actualizar.length+',valores:'+arreglo_valor_update.length);

if(id_items_actualizar.length==arreglo_valor_update.length){
for(i=0; i<id_items_actualizar.length;i++){
         var arreglo= {};
         arreglo['id_opcion']=id_items_actualizar[i];
         arreglo['valor']=arreglo_valor_update[i];

         datosPost_update.push(arreglo);
   }
		 
aInfo_update 	= JSON.stringify(datosPost_update);

}else{
    banderaupdateEntrega=false;
  $.alert({title: 'alerta!',content: 'debes llenar el listado de items'});
}




if(banderaupdateEntrega==true){
 $.mobile.loading('show');
  $("#btn_update_en_edit").prop('disabled', true);
  
    $.ajax({
           url:'http://191.98.228.86/GestionFlota_ApiRest/UpdateEntrega',
           type:'post',
           data:{
		   'id_resumen':id_resumen_en_edt,
		   'nombreusuario':logeado,
           'usuario':id_usuario,
		   'unidad':id_unidad_en_edt,
           'empresa':empresa_activa,
        
		   'tipo':select_edit_tipo_en_edt,
		   'kilometraje':edit_km_inicial_edt,
		   'combustible':edit_combustible_en,
		   'nombre_tipo_bateria':edit_tipo_bateria_en,
		   'nombre_entrego':edit_nombre_entrego_en,
           'identificacion_entrego':edit_identificacion_entrego_en,
           'nombre_recibe':edit_nombre_recibe_en,
           'identificacion_recibe':edit_identificacion_recibe_en,
           'file_fotos_en':file_fotos_up,
           'observacion_en':edit_observacion_entrega,
           'no_registro':parametro_no_registro,
           'referencia':parametro_referencia,
	       'array':aInfo_update, 
             'id_session':id_session  
		   
	},
           success: function(response){
   			//console.log(response);
			 $.mobile.loading('hide');
			  $("#btn_update_en_edit").prop('disabled', false);
   			$.alert({title: 'alerta!',content:response});
			 $("#popupEdit_entrega").hide();
			 CargarHistoricosEntregas();
           } 
         });
		 
		 
		 }
});//fin de boton guardar
 
 
$("#btn_cancel_en_edit").click(function(){ 
 
     $("#popupEdit_entrega").hide();
});
 
// borramos gestion de Entregas
function CancelarEntega(id){

 
$.confirm({
    title: 'Importante!',
    content: '¿deseas cancelar gestion?',
    buttons: {
        confirm: function () {
        
            $.ajax({
                 type: "POST",
                 url: "http://191.98.228.86/GestionFlota_ApiRest/cancelarEntrega",
                 data: { 
                         "id_resumen":id,
						 "nombreusuario":logeado,
						 "usuario":id_usuario,
						  "empresa":empresa_activa,
                           "id_session":id_session
                       },
                        beforeSend: function() {
                          $.mobile.loading('show');
                        },
                        success: function (data) {
                            $.mobile.loading('hide');
                            $.alert({title: 'Alerta!',content: data});
                            CargarHistoricosEntregas();
                       },
                          error: function (jqXHR, textStatus, errorThrown) {
                              var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse});
                   }
                });

        },
        cancel: function () {
            $.alert('Sin accion!');
        }
    }
});

}; //funcion cancelar

 
 
 
 
/*  -----------------__________________------------------------ */

/*  ----------------      Mi Cuenta     ----------------------- */

/*  -----------------__________________------------------------ */
 
 
$("#link_appcuenta").click(function(){ 
   
 if(id_usuario==''){
  $.mobile.changePage("#inicio");
  
 }else{

  $('#usr_update').html("");
  $('#usr_update').append(logeado);
  $.mobile.changePage("#myaccount");
 
 }   
	 
});
 
 
$('#atras_acon').bind("tap", function() {
     $.mobile.changePage("#home");
 
});



$('#btn_password').bind("tap", function() {

var pass_nuevo=$('#password_nuevo').val();

if(pass_nuevo==''){
    $.alert({title: 'Error!',content:'campo de contraseña vacio'});
 }else{
       var pass_actual=$('#password_actual').val();
	  

      if(pwd_insertado==pass_actual){
         campo='usr';
		
		 
  ActualizarCuenta(campo,pass_nuevo, pass_actual);
}else{
         $.alert({title: 'Error!',content:'contraseña incorrecta'});
       }
 }//fin de actualizar correo

});




function ActualizarCuenta(parametrocampo,parametrovalor,pass_actual){

$.ajax({
        type: "POST",
        url: "http://191.98.228.86/GestionFlota_ApiRest/actualizarCuenta",
        data: {"id_usuario": id_usuario,"campo": parametrocampo,"nuevo_valor": parametrovalor,
		"anterior":pass_actual},
        beforeSend: function() {
             $.mobile.loading('show');
        },success: function (data) {
              $.mobile.loading('hide');
			  
			  //console.log(data);
			  
                 if (data[0]=='Datos Actualizados'){
                     $.alert({title: 'Exito:',content: data});
                  }else {
                      $.alert({title: 'Alert!',content: 'Error al actualizar'});
                      }
                  },
                      error: function (jqXHR, textStatus, errorThrown) {
                               var errorResponse='';
	                         if (jqXHR.status === 0) {
                              errorResponse='Not connect: Verify Network.';
                            } else if (jqXHR.status == 404) {
                             errorResponse='Requested page not found [404]';
                             } else if (jqXHR.status == 500) {
                              errorResponse='Internal Server Error [500].';
                             } else if (textStatus === 'parsererror') {
                              errorResponse='Requested JSON parse failed.';
                             } else if (textStatus === 'timeout') {
                              errorResponse='Time out error.';
                            } else if (textStatus === 'abort') {
                              errorResponse='Ajax request aborted.';
                            } else {
                              errorResponse='Uncaught Error: ' + jqXHR.responseText;
                            }

	                     $.alert({title: 'Error!',content:errorResponse});

                  }
             });//fin de ajaz

}//fin de metodo actualizar






 
 
/*  -----------------__________________------------------------ */

/*  ----------------SALIR DE APLICACION----------------------- */

/*  -----------------__________________------------------------ */

$("#link_salirapp").click(function(){  
id_usuario='';logeado='';email_activo='';
pwd_insertado='';empresa_activa='';id_session='';
localStorage.setItem("appkey_usr", '');
clearInterval(myTimer); 
$.mobile.changePage("#inicio"); 
});



</script>

 
 
 
 
</body>
</html>
